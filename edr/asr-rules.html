<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASR Rules — Complete Reference | EDR Migration</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .mode-block { background: #991b1b; color: #fecaca; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .mode-audit { background: #92400e; color: #fef3c7; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .mode-warn { background: #1e40af; color: #dbeafe; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .mode-disabled { background: #374151; color: #d1d5db; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .risk-low { background: #166534; color: #dcfce7; }
    .risk-medium { background: #92400e; color: #fef3c7; }
    .risk-high { background: #991b1b; color: #fecaca; }
    .priority-1 { background: #166534; color: #dcfce7; }
    .priority-2 { background: #1e40af; color: #dbeafe; }
    .priority-3 { background: #92400e; color: #fef3c7; }
    .priority-4 { background: #991b1b; color: #fecaca; }
  </style>
</head>
<body>
  <div class="layout">
        <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">RF</div>
          <div class="sidebar-logo-text">
            <span class="sidebar-logo-title">Security Transformation</span>
            <span class="sidebar-logo-subtitle">RevFlow Analytics</span>
          </div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <a href="../index.html" class="nav-item">Executive Summary</a>
          <a href="../company-profile.html" class="nav-item">Company Profile</a>
          <a href="../security-framework.html" class="nav-item">Security Framework</a>
          <a href="../program-structure.html" class="nav-item">Program Structure</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">SIEM Migration</div>
          <a href="../siem/index.html" class="nav-item">SIEM Overview</a>
          <a href="../siem/discovery.html" class="nav-item">Discovery & Assessment</a>
          <a href="../siem/log-sources.html" class="nav-item">Log Source Strategy</a>
          <a href="../siem/log-engineering.html" class="nav-item">Log Engineering</a>
          <a href="../siem/parsing-deep-dive.html" class="nav-item">Parsing Deep Dive</a>
          <a href="../siem/threat-intelligence.html" class="nav-item">Threat Intelligence</a>
          <a href="../siem/detection-engineering.html" class="nav-item">Detection Engineering</a>
          <a href="../siem/detection-anatomy.html" class="nav-item">Detection Anatomy</a>
          <a href="../siem/detection-catalog.html" class="nav-item">Detection Catalog</a>
          <a href="../siem/soc-transition.html" class="nav-item">SOC Transition</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">EDR Migration</div>
          <a href="../edr/index.html" class="nav-item">EDR Overview</a>
          <a href="../edr/xdr-detection-model.html" class="nav-item">XDR Detection Model</a>
          <a href="../edr/deployment.html" class="nav-item">MDE Deployment</a>
          <a href="../edr/asr-rules.html" class="nav-item active">ASR Rules</a>
          <a href="../edr/coexistence.html" class="nav-item">Coexistence Strategy</a>
          <a href="../edr/eset-removal.html" class="nav-item">ESET Removal</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">DLP Migration</div>
          <a href="../dlp/index.html" class="nav-item">DLP Overview</a>
          <a href="../dlp/dlp-catalog.html" class="nav-item">DLP Catalog</a>
          <a href="../dlp/policy-translation.html" class="nav-item">Policy Translation</a>
          <a href="../dlp/rollout-phases.html" class="nav-item">Rollout Phases</a>
          <a href="../dlp/user-communication.html" class="nav-item">User Communication</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Identity & Access</div>
          <a href="../identity/index.html" class="nav-item">Identity Overview</a>
          <a href="../identity/hybrid-setup.html" class="nav-item">Hybrid Identity</a>
          <a href="../identity/conditional-access.html" class="nav-item">Conditional Access</a>
          <a href="../identity/pim.html" class="nav-item">PIM Configuration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Infrastructure</div>
          <a href="../infrastructure/index.html" class="nav-item">Infrastructure Overview</a>
          <a href="../infrastructure/landing-zone.html" class="nav-item">Landing Zone</a>
          <a href="../infrastructure/network-architecture.html" class="nav-item">Network Architecture</a>
          <a href="../infrastructure/workload-migration.html" class="nav-item">Workload Migration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="../operations/parallel-ops.html" class="nav-item">Parallel Operations</a>
          <a href="../operations/soc-workflows.html" class="nav-item">SOC Workflows</a>
          <a href="../operations/integration.html" class="nav-item">Platform Integration</a>
          <a href="../operations/xdr-integration.html" class="nav-item">XDR Integration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Resources</div>
          <a href="../resources/timeline.html" class="nav-item">Project Timeline</a>
          <a href="../resources/raci.html" class="nav-item">RACI Matrix</a>
          <a href="../resources/infrastructure-reference.html" class="nav-item">Infrastructure Reference</a>
          <a href="../resources/scripts.html" class="nav-item">Scripts & Queries</a>
          <a href="../resources/data-dictionary.html" class="nav-item">Data Dictionary</a>
          <a href="../resources/templates.html" class="nav-item">Templates</a>
          <a href="../resources/splunk-reference.html" class="nav-item">Splunk Reference</a>
          <a href="../resources/alternative-architectures.html" class="nav-item">Alternative Architectures</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Runbooks</div>
          <a href="../resources/mde-onboarding.html" class="nav-item">MDE Onboarding</a>
          <a href="../resources/mde-offboarding.html" class="nav-item">MDE Offboarding</a>
          <a href="../resources/incident-response.html" class="nav-item">Incident Response</a>
          <a href="../resources/operational-procedures.html" class="nav-item">Operational Procedures</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Troubleshooting</div>
          <a href="../troubleshooting/index.html" class="nav-item">Common Issues</a>
          <a href="../troubleshooting/siem-issues.html" class="nav-item">SIEM Issues</a>
          <a href="../troubleshooting/mde-issues.html" class="nav-item">MDE Issues</a>
          <a href="../troubleshooting/dlp-issues.html" class="nav-item">DLP Issues</a>
          <a href="../troubleshooting/agent-conflicts.html" class="nav-item">Agent Conflicts</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Career</div>
          <a href="../career-narrative.html" class="nav-item">Career Narrative</a>
          <a href="../interview-prep.html" class="nav-item">Interview Prep</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <div class="content-wrapper">
        <nav class="breadcrumb">
          <a href="../index.html">Home</a>
          <span class="breadcrumb-separator">/</span>
          <a href="index.html">EDR Migration</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">ASR Rules</span>
        </nav>

        <div class="page-header">
          <h1>Attack Surface Reduction (ASR) Rules — Complete Reference</h1>
          <div class="page-header-meta">
            <span class="page-badge edr">EDR Track</span>
            <span class="page-reading-time">Comprehensive Guide</span>
          </div>
          <p class="intro-text">Attack Surface Reduction rules are preventive controls that block common attack techniques before they execute. Microsoft provides <strong>19 standard ASR rules</strong> covering Office exploits, script abuse, credential theft, and lateral movement. This page documents all rules, their configuration, and RevFlow's deployment strategy.</p>
        </div>

        <!-- ==================== SECTION 1: OVERVIEW ==================== -->
        <h2>1. ASR Rules Overview</h2>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>What Are ASR Rules?</div>
          <div class="callout-content">
            <p>ASR rules are <strong>preventive controls</strong> built into Microsoft Defender for Endpoint. Unlike behavioral detections that alert after suspicious activity, ASR rules <strong>block actions before they complete</strong>.</p>
            <p style="margin-top: 0.5rem;">ASR rules target specific attack techniques from the MITRE ATT&CK framework, particularly: Initial Access, Execution, Persistence, and Credential Access.</p>
          </div>
        </div>

        <h3>1.1 Configuration Modes</h3>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Mode</th><th>Value</th><th>Behavior</th><th>When to Use</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="mode-disabled">Disabled</span></td>
                <td><code>0</code></td>
                <td>Rule is off. No logging, no blocking.</td>
                <td>Rule not applicable to environment</td>
              </tr>
              <tr>
                <td><span class="mode-audit">Audit</span></td>
                <td><code>2</code></td>
                <td>Logs what WOULD be blocked. No user impact.</td>
                <td>Initial deployment (2-8 weeks)</td>
              </tr>
              <tr>
                <td><span class="mode-warn">Warn</span></td>
                <td><code>6</code></td>
                <td>User sees warning, can click through. Logs event.</td>
                <td>Transition before Block (1-2 weeks)</td>
              </tr>
              <tr>
                <td><span class="mode-block">Block</span></td>
                <td><code>1</code></td>
                <td>Action is blocked. User cannot proceed.</td>
                <td>Full enforcement after validation</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>1.2 Deployment Flow</h3>

        <div class="flow-steps">
          <div class="flow-step"><div class="flow-step-number">1</div><div class="flow-step-content"><strong>Audit Mode (2-8 weeks)</strong><br>Deploy to pilot group. Monitor DeviceEvents for Asr*Audited events. Identify legitimate business processes that would be blocked.</div></div>
          <div class="flow-step"><div class="flow-step-number">2</div><div class="flow-step-content"><strong>Create Exclusions</strong><br>Add path/process exclusions for legitimate applications. Test exclusions in pilot before broad deployment.</div></div>
          <div class="flow-step"><div class="flow-step-number">3</div><div class="flow-step-content"><strong>Warn Mode (1-2 weeks)</strong><br>Users see warnings but can proceed. Validates exclusions are working. Catches edge cases.</div></div>
          <div class="flow-step"><div class="flow-step-number">4</div><div class="flow-step-content"><strong>Block Mode</strong><br>Full enforcement. Actions are blocked. Monitor for helpdesk tickets and adjust exclusions.</div></div>
        </div>

        <!-- ==================== SECTION 2: COMPLETE RULE LIST ==================== -->
        <h2>2. Complete ASR Rules Reference (19 Rules)</h2>

        <div class="callout critical">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>License Requirements</div>
          <div class="callout-content">
            <p><strong>Microsoft 365 E5 or Microsoft Defender for Endpoint P2</strong> required for full ASR functionality. Some rules work with Windows E3/E5 but advanced features require P2.</p>
          </div>
        </div>

        <h3>2.1 Office-Based Rules (5 Rules)</h3>
        <p>These rules block common Office-based attack vectors like malicious macros and embedded executables.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>#</th><th>Rule Name</th><th>GUID</th><th>What It Blocks</th><th>Attack Prevented</th><th>Risk</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td><strong>Block all Office applications from creating child processes</strong></td>
                <td><code>d4f940ab-401b-4efc-aadc-ad5f3c50688a</code></td>
                <td>Office apps (Word, Excel, PowerPoint, Outlook) spawning cmd.exe, powershell.exe, wscript.exe, etc.</td>
                <td>Macro-based malware execution, document weaponization</td>
                <td><span class="status-badge risk-medium">Medium</span></td>
              </tr>
              <tr>
                <td>2</td>
                <td><strong>Block Office applications from creating executable content</strong></td>
                <td><code>3b576869-a4ec-4529-8536-b80a7769e899</code></td>
                <td>Office apps writing .exe, .dll, .scr files to disk</td>
                <td>Dropper malware, payload staging</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>3</td>
                <td><strong>Block Office applications from injecting code into other processes</strong></td>
                <td><code>75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84</code></td>
                <td>Office apps performing process injection (CreateRemoteThread, etc.)</td>
                <td>Process hollowing, code injection</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>4</td>
                <td><strong>Block Win32 API calls from Office macros</strong></td>
                <td><code>92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b</code></td>
                <td>VBA macros calling dangerous Win32 APIs (VirtualAlloc, CreateThread, ShellExecute)</td>
                <td>Advanced macro malware, API abuse</td>
                <td><span class="status-badge risk-high">High</span></td>
              </tr>
              <tr>
                <td>5</td>
                <td><strong>Block Office communication application from creating child processes</strong></td>
                <td><code>26190899-1602-49e8-8b27-eb1d0a1ce869</code></td>
                <td>Outlook spawning child processes</td>
                <td>Email-delivered exploits, Outlook-based attacks</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>2.2 Script-Based Rules (4 Rules)</h3>
        <p>These rules block script-based attacks using JavaScript, VBScript, and PowerShell.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>#</th><th>Rule Name</th><th>GUID</th><th>What It Blocks</th><th>Attack Prevented</th><th>Risk</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>6</td>
                <td><strong>Block JavaScript or VBScript from launching downloaded executable content</strong></td>
                <td><code>d3e037e1-3eb8-44c8-a917-57927947596d</code></td>
                <td>JS/VBS downloading and executing payloads</td>
                <td>Drive-by downloads, malicious scripts</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>7</td>
                <td><strong>Block execution of potentially obfuscated scripts</strong></td>
                <td><code>5beb7efe-fd9a-4556-801d-275e5ffc04cc</code></td>
                <td>Encoded/obfuscated PowerShell, JS, VBS</td>
                <td>Obfuscated malware, encoded commands</td>
                <td><span class="status-badge risk-medium">Medium</span></td>
              </tr>
              <tr>
                <td>8</td>
                <td><strong>Block process creations originating from PSExec and WMI commands</strong></td>
                <td><code>d1e49aac-8f56-4280-b9ba-993a6d77406c</code></td>
                <td>PSExec, WMI creating remote processes</td>
                <td>Lateral movement, remote execution</td>
                <td><span class="status-badge risk-high">High</span></td>
              </tr>
              <tr>
                <td>9</td>
                <td><strong>Block untrusted and unsigned processes that run from USB</strong></td>
                <td><code>b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4</code></td>
                <td>Unsigned executables running from removable drives</td>
                <td>USB-based malware, BadUSB attacks</td>
                <td><span class="status-badge risk-medium">Medium</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>2.3 Email-Based Rules (2 Rules)</h3>
        <p>These rules block email-delivered threats.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>#</th><th>Rule Name</th><th>GUID</th><th>What It Blocks</th><th>Attack Prevented</th><th>Risk</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>10</td>
                <td><strong>Block executable content from email client and webmail</strong></td>
                <td><code>be9ba2d9-53ea-4cdc-84e5-9b1eeee46550</code></td>
                <td>Executables (.exe, .dll, .scr) from email attachments</td>
                <td>Email-delivered malware</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>11</td>
                <td><strong>Block only Office communication applications from creating child processes</strong></td>
                <td><code>26190899-1602-49e8-8b27-eb1d0a1ce869</code></td>
                <td>Outlook spawning processes (subset of rule #5)</td>
                <td>Outlook-specific exploits</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>2.4 Credential Protection Rules (2 Rules)</h3>
        <p>These rules block credential theft techniques.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>#</th><th>Rule Name</th><th>GUID</th><th>What It Blocks</th><th>Attack Prevented</th><th>Risk</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>12</td>
                <td><strong>Block credential stealing from the Windows local security authority subsystem (LSASS)</strong></td>
                <td><code>9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2</code></td>
                <td>Processes opening LSASS with suspicious access rights</td>
                <td>Mimikatz, LSASS dumping, credential theft</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>13</td>
                <td><strong>Block persistence through WMI event subscription</strong></td>
                <td><code>e6db77e5-3df2-4cf1-b95a-636979351e5b</code></td>
                <td>WMI event subscriptions for persistence</td>
                <td>Fileless persistence, WMI abuse</td>
                <td><span class="status-badge risk-medium">Medium</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>2.5 Ransomware & Advanced Rules (6 Rules)</h3>
        <p>These rules block ransomware, exploits, and advanced attack techniques.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>#</th><th>Rule Name</th><th>GUID</th><th>What It Blocks</th><th>Attack Prevented</th><th>Risk</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>14</td>
                <td><strong>Use advanced protection against ransomware</strong></td>
                <td><code>c1db55ab-c21a-4637-bb3f-a12568109d35</code></td>
                <td>Files with low reputation + suspicious characteristics</td>
                <td>Unknown ransomware, new variants</td>
                <td><span class="status-badge risk-medium">Medium</span></td>
              </tr>
              <tr>
                <td>15</td>
                <td><strong>Block executable files from running unless they meet prevalence, age, or trusted list criteria</strong></td>
                <td><code>01443614-cd74-433a-b99e-2ecdc07bfc25</code></td>
                <td>Executables with low prevalence/reputation</td>
                <td>Unknown malware, zero-day payloads</td>
                <td><span class="status-badge risk-high">High</span></td>
              </tr>
              <tr>
                <td>16</td>
                <td><strong>Block abuse of exploited vulnerable signed drivers</strong></td>
                <td><code>56a863a9-875e-4185-98a7-b882c64b5ce5</code></td>
                <td>Known vulnerable drivers being loaded</td>
                <td>BYOVD attacks, driver exploits</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>17</td>
                <td><strong>Block Adobe Reader from creating child processes</strong></td>
                <td><code>7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c</code></td>
                <td>Adobe Reader spawning cmd.exe, powershell.exe, etc.</td>
                <td>PDF-based exploits</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>18</td>
                <td><strong>Block Webshell creation for Servers</strong></td>
                <td><code>a8f5898e-1dc8-49a9-9878-85004b8a61e6</code></td>
                <td>IIS/web servers writing .asp, .aspx, .php files</td>
                <td>Webshell deployment</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
              <tr>
                <td>19</td>
                <td><strong>Block rebooting machine in Safe Mode (preview)</strong></td>
                <td><code>33ddedf1-c6e0-47cb-833e-de6133960387</code></td>
                <td>Attempts to reboot into Safe Mode programmatically</td>
                <td>Security tool bypass, safe mode abuse</td>
                <td><span class="status-badge risk-low">Low</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- ==================== SECTION 3: REVFLOW CONFIGURATION ==================== -->
        <h2>3. RevFlow ASR Configuration</h2>

        <h3>3.1 Deployment Priorities</h3>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>RevFlow Strategy</div>
          <div class="callout-content">
            <p>We deploy ASR rules in 4 priority waves based on business impact risk. Low-risk rules first, high-risk rules last with extended audit periods.</p>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Priority</th><th>Rules</th><th>Risk Level</th><th>Audit Period</th><th>Target Mode</th><th>Timeline</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="status-badge priority-1">P1</span></td>
                <td>
                  #10 Block email executables<br>
                  #12 Block LSASS credential theft<br>
                  #2 Block Office creating executables<br>
                  #3 Block Office code injection<br>
                  #16 Block vulnerable drivers<br>
                  #17 Block Adobe Reader child processes
                </td>
                <td>Low</td>
                <td>2 weeks</td>
                <td><span class="mode-block">Block</span></td>
                <td>Week 1-4</td>
              </tr>
              <tr>
                <td><span class="status-badge priority-2">P2</span></td>
                <td>
                  #1 Block Office child processes<br>
                  #6 Block JS/VBS downloading executables<br>
                  #5 Block Outlook child processes<br>
                  #14 Advanced ransomware protection
                </td>
                <td>Low-Medium</td>
                <td>3 weeks</td>
                <td><span class="mode-block">Block</span></td>
                <td>Week 4-8</td>
              </tr>
              <tr>
                <td><span class="status-badge priority-3">P3</span></td>
                <td>
                  #7 Block obfuscated scripts<br>
                  #9 Block USB untrusted processes<br>
                  #13 Block WMI persistence
                </td>
                <td>Medium</td>
                <td>4 weeks</td>
                <td><span class="mode-block">Block</span></td>
                <td>Week 8-12</td>
              </tr>
              <tr>
                <td><span class="status-badge priority-4">P4</span></td>
                <td>
                  #4 Block Win32 API from macros<br>
                  #8 Block PSExec/WMI<br>
                  #15 Block low-prevalence executables
                </td>
                <td>High</td>
                <td>6-8 weeks</td>
                <td><span class="mode-warn">Warn</span> then <span class="mode-block">Block</span></td>
                <td>Week 12-20</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>3.2 Current RevFlow ASR Status</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">RevFlow ASR Rule Status</span></div>
          <pre><code>REVFLOW ATTACK SURFACE REDUCTION CONFIGURATION
═══════════════════════════════════════════════════════════════════════════════
Environment: 9,000 Windows endpoints (7,200 workstations, 1,800 servers)
Last Updated: December 2025

PRIORITY 1 — LOW RISK (Block Mode Enabled)
────────────────────────────────────────────────────────────────────────────────
✅ be9ba2d9-53ea-4cdc-84e5-9b1eeee46550  Block email executables         [BLOCK]
✅ 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2  Block LSASS credential theft    [BLOCK]
✅ 3b576869-a4ec-4529-8536-b80a7769e899  Block Office creating exes      [BLOCK]
✅ 75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84  Block Office code injection     [BLOCK]
✅ 56a863a9-875e-4185-98a7-b882c64b5ce5  Block vulnerable drivers        [BLOCK]
✅ 7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c  Block Adobe Reader children     [BLOCK]

PRIORITY 2 — LOW-MEDIUM RISK (Block Mode Enabled)
────────────────────────────────────────────────────────────────────────────────
✅ d4f940ab-401b-4efc-aadc-ad5f3c50688a  Block Office child processes    [BLOCK]
✅ d3e037e1-3eb8-44c8-a917-57927947596d  Block JS/VBS executables        [BLOCK]
✅ 26190899-1602-49e8-8b27-eb1d0a1ce869  Block Outlook child processes   [BLOCK]
✅ c1db55ab-c21a-4637-bb3f-a12568109d35  Advanced ransomware protection  [BLOCK]

PRIORITY 3 — MEDIUM RISK (Block Mode Enabled)
────────────────────────────────────────────────────────────────────────────────
✅ 5beb7efe-fd9a-4556-801d-275e5ffc04cc  Block obfuscated scripts        [BLOCK]
✅ b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4  Block USB untrusted processes   [BLOCK]
✅ e6db77e5-3df2-4cf1-b95a-636979351e5b  Block WMI persistence           [BLOCK]

PRIORITY 4 — HIGH RISK (Warn/Audit Mode)
────────────────────────────────────────────────────────────────────────────────
⚠️ 92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b  Block Win32 API from macros     [WARN]
⚠️ d1e49aac-8f56-4280-b9ba-993a6d77406c  Block PSExec/WMI processes      [AUDIT]
⏸️ 01443614-cd74-433a-b99e-2ecdc07bfc25  Block low-prevalence exes       [DISABLED]

SERVER-SPECIFIC RULES
────────────────────────────────────────────────────────────────────────────────
✅ a8f5898e-1dc8-49a9-9878-85004b8a61e6  Block webshell creation         [BLOCK]

EXCLUSIONS CONFIGURED: 47
────────────────────────────────────────────────────────────────────────────────
• C:\Program Files\RevFlow\* (internal app)
• C:\Program Files\SAP\* (ERP system)
• C:\Program Files\Salesforce\* (CRM)
• C:\AdminTools\* (IT admin scripts - requires approval)
• 12 additional vendor-specific exclusions</code></pre>
        </div>

        <!-- ==================== SECTION 4: INTUNE CONFIGURATION ==================== -->
        <h2>4. Intune Configuration</h2>

        <h3>4.1 Create ASR Policy in Intune</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">Intune Portal Steps</span></div>
          <pre><code>INTUNE ASR POLICY CONFIGURATION
═══════════════════════════════════════════════════════════════════════════════

LOCATION: Microsoft Intune admin center → Endpoint security → Attack surface reduction

STEP 1: CREATE POLICY
────────────────────────────────────────────────────────────────────────────────
1. Go to: Endpoint security → Attack surface reduction → Create Policy
2. Platform: Windows 10 and later
3. Profile: Attack Surface Reduction Rules
4. Name: "RevFlow-ASR-Production" or "RevFlow-ASR-Pilot"

STEP 2: CONFIGURE RULES
────────────────────────────────────────────────────────────────────────────────
Each rule has 4 options:
• Not configured (inherits from baseline)
• Block (value = 1)
• Audit (value = 2)
• Warn (value = 6)
• Disable (value = 0)

STEP 3: CONFIGURE EXCLUSIONS (Same policy)
────────────────────────────────────────────────────────────────────────────────
Attack Surface Reduction Only Exclusions:
• Add paths: C:\Program Files\TrustedApp\app.exe
• Add folders: C:\CustomScripts\ (use sparingly)

STEP 4: ASSIGNMENTS
────────────────────────────────────────────────────────────────────────────────
• Pilot: Assign to "MDE-Pilot-ASR" device group (100 devices)
• Production: Assign to "All-Windows-Devices" group
• Exclusions: Exclude "ASR-Exceptions" group (legacy systems)

STEP 5: SCOPE TAGS (Optional)
────────────────────────────────────────────────────────────────────────────────
• Tag: "Security-Managed" for SOC visibility</code></pre>
        </div>

        <h3>4.2 Intune Policy JSON Export</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">JSON - Intune ASR Policy (P1 + P2 Rules)</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>{
  "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
  "displayName": "RevFlow-ASR-Production",
  "description": "ASR rules for RevFlow production endpoints",
  "defenderAttackSurfaceReductionExcludedPaths": [
    "C:\\Program Files\\RevFlow\\*",
    "C:\\Program Files\\SAP\\*",
    "C:\\Program Files (x86)\\Salesforce\\*"
  ],
  "defenderGuardedFoldersAllowedAppPaths": [],
  "defenderAdditionalGuardedFolders": [],
  "defenderExploitProtectionXml": null,
  "defenderExploitProtectionXmlFileName": null,
  "defenderSecurityCenterBlockExploitProtectionOverride": true,
  "defenderBlockPersistenceThroughWmiType": "block",
  "defenderAdobeReaderLaunchChildProcess": "block",
  "defenderOfficeAppsExecutableContentCreationOrLaunchType": "block",
  "defenderOfficeAppsLaunchChildProcessType": "block",
  "defenderOfficeMacroCodeAllowWin32ImportsType": "warn",
  "defenderOfficeCommunicationAppsLaunchChildProcess": "block",
  "defenderOfficeAppsOtherProcessInjectionType": "block",
  "defenderScriptObfuscatedMacroCodeType": "block",
  "defenderScriptDownloadedPayloadExecutionType": "block",
  "defenderEmailContentExecutionType": "block",
  "defenderPreventCredentialStealingType": "block",
  "defenderUntrustedUSBProcessType": "block",
  "defenderUntrustedExecutableType": "auditMode",
  "defenderProcessCreationType": "auditMode",
  "defenderAdvancedRansomewareProtectionType": "block",
  "defenderBlockVulnerableSignedDrivers": true,
  "defenderGuardMyFoldersType": "enable"
}</code></pre>
        </div>

        <!-- ==================== SECTION 5: POWERSHELL CONFIGURATION ==================== -->
        <h2>5. PowerShell Configuration</h2>

        <h3>5.1 View Current ASR Configuration</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">PowerShell - View ASR Status</span><button class="code-copy-btn">Copy</button></div>
          <pre><code># View all ASR rule states
Get-MpPreference | Select-Object -ExpandProperty AttackSurfaceReductionRules_Ids
Get-MpPreference | Select-Object -ExpandProperty AttackSurfaceReductionRules_Actions

# Human-readable format
$rules = Get-MpPreference
$ids = $rules.AttackSurfaceReductionRules_Ids
$actions = $rules.AttackSurfaceReductionRules_Actions

$ruleNames = @{
    "d4f940ab-401b-4efc-aadc-ad5f3c50688a" = "Block Office child processes"
    "3b576869-a4ec-4529-8536-b80a7769e899" = "Block Office creating executables"
    "75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84" = "Block Office code injection"
    "92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b" = "Block Win32 API from macros"
    "26190899-1602-49e8-8b27-eb1d0a1ce869" = "Block Outlook child processes"
    "d3e037e1-3eb8-44c8-a917-57927947596d" = "Block JS/VBS executables"
    "5beb7efe-fd9a-4556-801d-275e5ffc04cc" = "Block obfuscated scripts"
    "d1e49aac-8f56-4280-b9ba-993a6d77406c" = "Block PSExec/WMI"
    "b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4" = "Block USB untrusted"
    "be9ba2d9-53ea-4cdc-84e5-9b1eeee46550" = "Block email executables"
    "9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2" = "Block LSASS credential theft"
    "c1db55ab-c21a-4637-bb3f-a12568109d35" = "Advanced ransomware protection"
    "01443614-cd74-433a-b99e-2ecdc07bfc25" = "Block low-prevalence executables"
    "e6db77e5-3df2-4cf1-b95a-636979351e5b" = "Block WMI persistence"
    "56a863a9-875e-4185-98a7-b882c64b5ce5" = "Block vulnerable drivers"
    "7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c" = "Block Adobe Reader children"
    "a8f5898e-1dc8-49a9-9878-85004b8a61e6" = "Block webshell creation"
}

$actionNames = @{
    0 = "Disabled"
    1 = "Block"
    2 = "Audit"
    6 = "Warn"
}

for ($i = 0; $i -lt $ids.Count; $i++) {
    $ruleName = $ruleNames[$ids[$i]]
    $actionName = $actionNames[$actions[$i]]
    Write-Host "$ruleName : $actionName"
}</code></pre>
        </div>

        <h3>5.2 Set ASR Rules via PowerShell</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">PowerShell - Configure ASR Rules</span><button class="code-copy-btn">Copy</button></div>
          <pre><code># Enable ASR rule in Block mode (1 = Block, 2 = Audit, 0 = Disabled, 6 = Warn)
# Block credential stealing from LSASS
Set-MpPreference -AttackSurfaceReductionRules_Ids 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2 -AttackSurfaceReductionRules_Actions 1

# Set multiple rules at once (P1 rules in Block mode)
Set-MpPreference -AttackSurfaceReductionRules_Ids `
    be9ba2d9-53ea-4cdc-84e5-9b1eeee46550, `
    9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2, `
    3b576869-a4ec-4529-8536-b80a7769e899, `
    75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84, `
    56a863a9-875e-4185-98a7-b882c64b5ce5, `
    7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c `
    -AttackSurfaceReductionRules_Actions 1,1,1,1,1,1

# Set rule to Audit mode for testing
Set-MpPreference -AttackSurfaceReductionRules_Ids d1e49aac-8f56-4280-b9ba-993a6d77406c -AttackSurfaceReductionRules_Actions 2

# Set rule to Warn mode
Set-MpPreference -AttackSurfaceReductionRules_Ids 92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b -AttackSurfaceReductionRules_Actions 6

# Disable a rule
Set-MpPreference -AttackSurfaceReductionRules_Ids 01443614-cd74-433a-b99e-2ecdc07bfc25 -AttackSurfaceReductionRules_Actions 0</code></pre>
        </div>

        <h3>5.3 Manage Exclusions</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">PowerShell - ASR Exclusions</span><button class="code-copy-btn">Copy</button></div>
          <pre><code># View current ASR exclusions
Get-MpPreference | Select-Object -ExpandProperty AttackSurfaceReductionOnlyExclusions

# Add exclusion for specific executable
Add-MpPreference -AttackSurfaceReductionOnlyExclusions "C:\Program Files\BusinessApp\helper.exe"

# Add exclusion for folder (use sparingly - less secure)
Add-MpPreference -AttackSurfaceReductionOnlyExclusions "C:\Program Files\TrustedVendor\*"

# Add multiple exclusions
Add-MpPreference -AttackSurfaceReductionOnlyExclusions `
    "C:\Program Files\SAP\*", `
    "C:\Program Files\Salesforce\connector.exe", `
    "C:\CustomScripts\approved-script.ps1"

# Remove an exclusion
Remove-MpPreference -AttackSurfaceReductionOnlyExclusions "C:\OldApp\legacy.exe"

# Clear all exclusions (CAUTION)
# Set-MpPreference -AttackSurfaceReductionOnlyExclusions @()</code></pre>
        </div>

        <!-- ==================== SECTION 6: MONITORING ==================== -->
        <h2>6. Monitoring ASR Events</h2>

        <h3>6.1 XDR Advanced Hunting Queries</h3>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Where to Run</div>
          <div class="callout-content">
            <p><strong>security.microsoft.com → Hunting → Advanced Hunting</strong></p>
            <p>ASR events are in DeviceEvents table. ActionType starts with "Asr" (e.g., AsrOfficeChildProcessBlocked, AsrOfficeChildProcessAudited).</p>
          </div>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - ASR Summary (Last 7 Days)</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// Summary of all ASR events by rule and action
DeviceEvents
| where Timestamp > ago(7d)
| where ActionType startswith "Asr"
| extend RuleType = case(
    ActionType contains "Audited", "Audit",
    ActionType contains "Blocked", "Block",
    ActionType contains "Warned", "Warn",
    "Other"
)
| summarize 
    Events = count(),
    Devices = dcount(DeviceName),
    Users = dcount(AccountName)
    by ActionType, RuleType
| order by Events desc</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - ASR Audit Events (Pre-Block Analysis)</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// Detailed breakdown for audit mode - review before enabling Block
DeviceEvents
| where Timestamp > ago(14d)
| where ActionType endswith "Audited"
| summarize 
    Count = count(),
    UniqueDevices = dcount(DeviceName),
    UniqueUsers = dcount(AccountName),
    SampleFiles = make_set(FileName, 5),
    SamplePaths = make_set(FolderPath, 5)
    by ActionType
| order by Count desc

// If Count is high, investigate further before enabling Block</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - Specific Rule Deep Dive</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// Deep dive into Office child process rule (most common to tune)
DeviceEvents
| where Timestamp > ago(7d)
| where ActionType in ("AsrOfficeChildProcessAudited", "AsrOfficeChildProcessBlocked")
| project 
    Timestamp,
    DeviceName,
    AccountName,
    FileName,           // Child process that was blocked/audited
    FolderPath,
    ProcessCommandLine,
    InitiatingProcessFileName,  // Office app (WINWORD.EXE, EXCEL.EXE)
    InitiatingProcessCommandLine
| order by Timestamp desc

// Group by blocked process to identify exclusion candidates
DeviceEvents
| where Timestamp > ago(14d)
| where ActionType == "AsrOfficeChildProcessAudited"
| summarize 
    Count = count(),
    Devices = dcount(DeviceName)
    by FileName, FolderPath
| where Count > 10  // Focus on frequent events
| order by Count desc</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - LSASS Protection Events</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// LSASS credential theft attempts (should be rare in production)
DeviceEvents
| where Timestamp > ago(7d)
| where ActionType in ("AsrLsassCredentialTheftAudited", "AsrLsassCredentialTheftBlocked")
| project 
    Timestamp,
    DeviceName,
    AccountName,
    FileName,
    FolderPath,
    ProcessCommandLine,
    InitiatingProcessFileName
| order by Timestamp desc

// If you see legitimate tools here, add to exclusions
// Common false positives: Backup agents, monitoring tools</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - PSExec/WMI Rule Analysis</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// PSExec and WMI process creation (HIGH RISK rule - extended audit)
DeviceEvents
| where Timestamp > ago(30d)
| where ActionType in ("AsrPsexecWmiChildProcessAudited", "AsrPsexecWmiChildProcessBlocked")
| project 
    Timestamp,
    DeviceName,
    AccountName,
    FileName,
    ProcessCommandLine,
    InitiatingProcessFileName,
    InitiatingProcessAccountName
| summarize 
    Count = count(),
    Devices = dcount(DeviceName),
    SampleCommands = make_set(ProcessCommandLine, 3)
    by InitiatingProcessAccountName, InitiatingProcessFileName
| order by Count desc

// Review each unique account/process combination
// IT admin tools (SCCM, monitoring) often trigger this rule</code></pre>
        </div>

        <h3>6.2 Windows Event Log</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">Event Log Location</span></div>
          <pre><code>ASR EVENT LOG LOCATIONS
═══════════════════════════════════════════════════════════════════════════════

PRIMARY LOG:
Applications and Services Logs → Microsoft → Windows → Windows Defender → Operational

EVENT IDS:
• 1121 - ASR rule triggered in Block mode
• 1122 - ASR rule triggered in Audit mode
• 1129 - ASR rule triggered in Warn mode (user bypassed)

POWERSHELL QUERY:
Get-WinEvent -LogName "Microsoft-Windows-Windows Defender/Operational" |
    Where-Object { $_.Id -in (1121, 1122, 1129) } |
    Select-Object TimeCreated, Id, Message |
    Format-Table -AutoSize</code></pre>
        </div>

        <!-- ==================== SECTION 7: EXCLUSIONS ==================== -->
        <h2>7. Exclusion Management</h2>

        <h3>7.1 Exclusion Best Practices</h3>

        <div class="callout warning">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Exclusion Principle</div>
          <div class="callout-content">
            <p><strong>Be specific.</strong> Exclude specific executables, not entire folders. Every exclusion is a potential attack vector.</p>
            <p style="margin-top: 0.5rem;"><strong>Document everything.</strong> Every exclusion should have a ticket number, business justification, and owner.</p>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Exclusion Type</th><th>Example</th><th>Security Risk</th><th>When to Use</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Specific Executable</strong></td>
                <td><code>C:\Program Files\App\app.exe</code></td>
                <td><span class="status-badge risk-low">Low</span></td>
                <td>Preferred. Use whenever possible.</td>
              </tr>
              <tr>
                <td><strong>Folder with Wildcard</strong></td>
                <td><code>C:\Program Files\App\*</code></td>
                <td><span class="status-badge risk-medium">Medium</span></td>
                <td>Only if app has many executables that all need exclusion.</td>
              </tr>
              <tr>
                <td><strong>Recursive Folder</strong></td>
                <td><code>C:\Apps\**\*.exe</code></td>
                <td><span class="status-badge risk-high">High</span></td>
                <td>Avoid. Creates large attack surface.</td>
              </tr>
              <tr>
                <td><strong>Process Name Only</strong></td>
                <td><code>app.exe</code></td>
                <td><span class="status-badge risk-high">High</span></td>
                <td>Avoid. Attacker can name malware "app.exe".</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>7.2 RevFlow Exclusions Registry</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">RevFlow ASR Exclusions</span></div>
          <pre><code>REVFLOW ASR EXCLUSIONS REGISTRY
═══════════════════════════════════════════════════════════════════════════════
Total Exclusions: 47 (as of December 2025)
Review Cadence: Quarterly

CATEGORY: INTERNAL APPLICATIONS (12 exclusions)
────────────────────────────────────────────────────────────────────────────────
Path: C:\Program Files\RevFlow\analytics.exe
Justification: Core analytics platform, spawns child processes for data processing
Ticket: SEC-2024-0142
Owner: Engineering Team
Rule Affected: Block Office child processes (#1)

Path: C:\Program Files\RevFlow\connector.exe
Justification: Integration connector for Salesforce
Ticket: SEC-2024-0156
Owner: Integration Team
Rule Affected: Block Office child processes (#1)

[... additional entries ...]

CATEGORY: VENDOR APPLICATIONS (23 exclusions)
────────────────────────────────────────────────────────────────────────────────
Path: C:\Program Files\SAP\Frontend\SAPgui.exe
Justification: SAP GUI launches multiple child processes
Ticket: SEC-2024-0089
Owner: ERP Team
Rule Affected: Block Office child processes (#1), Block obfuscated scripts (#7)

Path: C:\Program Files (x86)\Salesforce\dataloader.exe
Justification: Salesforce Data Loader uses obfuscated scripts
Ticket: SEC-2024-0102
Owner: Sales Ops
Rule Affected: Block obfuscated scripts (#7)

[... additional entries ...]

CATEGORY: IT ADMIN TOOLS (12 exclusions)
────────────────────────────────────────────────────────────────────────────────
Path: C:\AdminTools\deploy.ps1
Justification: Approved deployment script (signed)
Ticket: SEC-2024-0201
Owner: IT Operations
Rule Affected: Block PSExec/WMI (#8)
Review: Monthly (high-risk exclusion)

Path: C:\Program Files\SCCM\client\ccmexec.exe
Justification: SCCM client creates child processes
Ticket: SEC-2024-0045
Owner: IT Operations
Rule Affected: Block PSExec/WMI (#8)

[... additional entries ...]</code></pre>
        </div>

        <!-- ==================== SECTION 8: TROUBLESHOOTING ==================== -->
        <h2>8. Troubleshooting</h2>

        <h3>8.1 Common Issues</h3>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Issue</th><th>Symptoms</th><th>Resolution</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Business app broken after ASR enabled</strong></td>
                <td>App fails to launch, error message about blocked action</td>
                <td>1. Check DeviceEvents for AsrBlocked events<br>2. Identify blocked process<br>3. Add specific exclusion<br>4. Test in pilot before production</td>
              </tr>
              <tr>
                <td><strong>Macro-based workflow broken</strong></td>
                <td>Excel/Word macros fail to run automated tasks</td>
                <td>1. Review Win32 API rule (#4) events<br>2. Consider Warn mode instead of Block<br>3. Add specific macro file exclusion if legitimate</td>
              </tr>
              <tr>
                <td><strong>IT admin tools blocked</strong></td>
                <td>PSExec, WMI scripts fail on endpoints</td>
                <td>1. PSExec/WMI rule (#8) is high-risk<br>2. Keep in Audit mode for admin workstations<br>3. Use device groups to exclude IT devices</td>
              </tr>
              <tr>
                <td><strong>USB devices not working</strong></td>
                <td>Legitimate USB apps blocked</td>
                <td>1. Check USB rule (#9) events<br>2. Sign legitimate USB applications<br>3. Add specific exclusions for known vendor software</td>
              </tr>
              <tr>
                <td><strong>Too many audit events</strong></td>
                <td>XDR flooded with Asr*Audited events</td>
                <td>1. Prioritize rules with high event counts<br>2. Add exclusions for known-good processes<br>3. Move rule to Block mode to reduce noise</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>8.2 Diagnostic Commands</h3>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">PowerShell - ASR Diagnostics</span><button class="code-copy-btn">Copy</button></div>
          <pre><code># Check if ASR is enabled and working
Get-MpComputerStatus | Select-Object AMRunningMode, AntivirusEnabled, RealTimeProtectionEnabled

# Check ASR rule configuration
Get-MpPreference | Select-Object -Property AttackSurfaceReductionRules_Ids, AttackSurfaceReductionRules_Actions

# Check exclusions
Get-MpPreference | Select-Object -ExpandProperty AttackSurfaceReductionOnlyExclusions

# Check recent ASR blocks (Event Log)
Get-WinEvent -LogName "Microsoft-Windows-Windows Defender/Operational" -MaxEvents 50 |
    Where-Object { $_.Id -in (1121, 1122, 1129) } |
    Format-Table TimeCreated, Id, Message -AutoSize

# Test specific rule behavior (requires test file)
# Create test: echo "test" > C:\temp\test.exe
# Try to launch from Office - should be blocked</code></pre>
        </div>

        <!-- ==================== SECTION 9: BEST PRACTICES ==================== -->
        <h2>9. Best Practices Summary</h2>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Microsoft & Industry Best Practices</div>
          <div class="callout-content">
            <p><strong>Deployment:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Always Audit → Warn → Block progression (never Block on day 1)</li>
              <li>Minimum 2-4 weeks Audit per rule (Microsoft recommends 30 days)</li>
              <li>Start with low-risk rules (Office, email, LSASS)</li>
              <li>Extend audit period for high-risk rules (PSExec/WMI, Win32 API)</li>
            </ul>
            <p style="margin-top: 1rem;"><strong>Exclusions:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Exclude specific executables, not folders</li>
              <li>Document every exclusion with ticket and owner</li>
              <li>Review exclusions quarterly</li>
              <li>Test exclusions in pilot before production</li>
            </ul>
            <p style="margin-top: 1rem;"><strong>Monitoring:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Review DeviceEvents daily during rollout</li>
              <li>Create alert for sudden spike in Block events</li>
              <li>Track helpdesk tickets related to ASR</li>
            </ul>
            <p style="margin-top: 1rem;"><strong>CIS Benchmark Alignment:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>CIS Microsoft 365 E5 Level 1: LSASS protection, Office child process rules</li>
              <li>CIS Microsoft 365 E5 Level 2: All ASR rules with appropriate exclusions</li>
            </ul>
          </div>
        </div>

        <nav class="page-nav">
          <a href="deployment.html" class="page-nav-link prev"><span class="page-nav-label">Previous</span><span class="page-nav-title">← MDE Deployment</span></a>
          <a href="coexistence.html" class="page-nav-link next"><span class="page-nav-label">Next</span><span class="page-nav-title">Coexistence Strategy →</span></a>
        </nav>
      </div>
    </main>
  </div>
  <script src="../js/main.js"></script>
</body>
</html>
