<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incident Response Runbook | Security Transformation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <div class="layout">
        <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">RF</div>
          <div class="sidebar-logo-text">
            <span class="sidebar-logo-title">Security Transformation</span>
            <span class="sidebar-logo-subtitle">RevFlow Analytics</span>
          </div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <a href="../index.html" class="nav-item">Executive Summary</a>
          <a href="../company-profile.html" class="nav-item">Company Profile</a>
          <a href="../security-framework.html" class="nav-item">Security Framework</a>
          <a href="../program-structure.html" class="nav-item">Program Structure</a>
          <a href="../controls-mapping.html" class="nav-item">Controls Mapping</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">SIEM Migration</div>
          <a href="../siem/index.html" class="nav-item">SIEM Overview</a>
          <a href="../siem/discovery.html" class="nav-item">Discovery & Assessment</a>
          <a href="../siem/log-sources.html" class="nav-item">Log Source Strategy</a>
          <a href="../siem/log-engineering.html" class="nav-item">Log Engineering</a>
          <a href="../siem/parsing-deep-dive.html" class="nav-item">Parsing Deep Dive</a>
          <a href="../siem/threat-intelligence.html" class="nav-item">Threat Intelligence</a>
          <a href="../siem/detection-engineering.html" class="nav-item">Detection Engineering</a>
          <a href="../siem/detection-anatomy.html" class="nav-item">Detection Anatomy</a>
          <a href="../siem/detection-catalog.html" class="nav-item">Detection Catalog</a>
          <a href="../siem/soar-automation.html" class="nav-item">SOAR &amp; Automation</a>
          <a href="../siem/workbooks.html" class="nav-item">Workbooks &amp; Dashboards</a>
          <a href="../siem/cost-optimization.html" class="nav-item">Cost Optimization</a>
          <a href="../siem/casb-saas-security.html" class="nav-item">CASB &amp; SaaS Security</a>
          <a href="../siem/soc-transition.html" class="nav-item">SOC Transition</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">EDR Migration</div>
          <a href="../edr/index.html" class="nav-item">EDR Overview</a>
          <a href="../edr/xdr-detection-model.html" class="nav-item">XDR Detection Model</a>
          <a href="../edr/advanced-hunting.html" class="nav-item">Advanced Hunting</a>
          <a href="../edr/live-response.html" class="nav-item">Live Response</a>
          <a href="../edr/tvm.html" class="nav-item">Vulnerability Management</a>
          <a href="../edr/deployment.html" class="nav-item">MDE Deployment</a>
          <a href="../edr/asr-rules.html" class="nav-item">ASR Rules</a>
          <a href="../edr/device-control.html" class="nav-item">Device Control</a>
          <a href="../edr/compensating-controls.html" class="nav-item">Compensating Controls</a>
          <a href="../edr/coexistence.html" class="nav-item">Coexistence Strategy</a>
          <a href="../edr/eset-removal.html" class="nav-item">ESET Removal</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">DLP Migration</div>
          <a href="../dlp/index.html" class="nav-item">DLP Overview</a>
          <a href="../dlp/dlp-catalog.html" class="nav-item">DLP Catalog</a>
          <a href="../dlp/policy-translation.html" class="nav-item">Policy Translation</a>
          <a href="../dlp/rollout-phases.html" class="nav-item">Rollout Phases</a>
          <a href="../dlp/user-communication.html" class="nav-item">User Communication</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Identity & Access</div>
          <a href="../identity/index.html" class="nav-item">Identity Overview</a>
          <a href="../identity/hybrid-setup.html" class="nav-item">Hybrid Identity</a>
          <a href="../identity/conditional-access.html" class="nav-item">Conditional Access</a>
          <a href="../identity/pim.html" class="nav-item">PIM Configuration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Infrastructure</div>
          <a href="../infrastructure/index.html" class="nav-item">Infrastructure Overview</a>
          <a href="../infrastructure/landing-zone.html" class="nav-item">Landing Zone</a>
          <a href="../infrastructure/network-architecture.html" class="nav-item">Network Architecture</a>
          <a href="../infrastructure/workload-migration.html" class="nav-item">Workload Migration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="../operations/parallel-ops.html" class="nav-item">Parallel Operations</a>
          <a href="../operations/soc-workflows.html" class="nav-item">SOC Workflows</a>
          <a href="../operations/integration.html" class="nav-item">Platform Integration</a>
          <a href="../operations/xdr-integration.html" class="nav-item">XDR Integration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Resources</div>
          <a href="../resources/timeline.html" class="nav-item">Project Timeline</a>
          <a href="../resources/raci.html" class="nav-item">RACI Matrix</a>
          <a href="../resources/infrastructure-reference.html" class="nav-item">Infrastructure Reference</a>
          <a href="../resources/scripts.html" class="nav-item">Scripts & Queries</a>
          <a href="../resources/data-dictionary.html" class="nav-item">Data Dictionary</a>
          <a href="../resources/templates.html" class="nav-item">Templates</a>
          <a href="../resources/splunk-reference.html" class="nav-item">Splunk Reference</a>
          <a href="../resources/alternative-architectures.html" class="nav-item">Alternative Architectures</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Runbooks</div>
          <a href="../resources/mde-onboarding.html" class="nav-item">MDE Onboarding</a>
          <a href="../resources/mde-offboarding.html" class="nav-item">MDE Offboarding</a>
          <a href="../resources/incident-response.html" class="nav-item">Incident Response</a>
          <a href="../resources/operational-procedures.html" class="nav-item">Operational Procedures</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Troubleshooting</div>
          <a href="../troubleshooting/index.html" class="nav-item">Common Issues</a>
          <a href="../troubleshooting/siem-issues.html" class="nav-item">SIEM Issues</a>
          <a href="../troubleshooting/mde-issues.html" class="nav-item">MDE Issues</a>
          <a href="../troubleshooting/dlp-issues.html" class="nav-item">DLP Issues</a>
          <a href="../troubleshooting/agent-conflicts.html" class="nav-item">Agent Conflicts</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Career</div>
          <a href="../career-narrative.html" class="nav-item">Career Narrative</a>
          <a href="../interview-prep.html" class="nav-item">Interview Prep (Full)</a>
          <a href="../interview-prep-v2.html" class="nav-item">Interview Prep v2</a>
          <a href="../interview-technical-reference.html" class="nav-item">Technical Reference</a>
          <a href="../interview-frameworks.html" class="nav-item">Mental Frameworks</a>
          <a href="../director-interview-prep.html" class="nav-item">Director Interview Prep</a>
          <a href="../soc-maturity.html" class="nav-item">SOC Maturity Roadmap</a>
          <a href="../security-mental-model.html" class="nav-item">Security Mental Model</a>
          <a href="../ai-security-risk.html" class="nav-item">AI Security & Risk</a>
        </div>
      </nav>
    </aside>
    <button class="mobile-menu-toggle" aria-label="Toggle menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"></path></svg>
    </button>
    <div class="sidebar-overlay"></div>
    <main class="main-content">
      <div class="content-wrapper">
        <nav class="breadcrumb">
          <a href="../index.html" class="breadcrumb-link">Home</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">Incident Response Runbook</span>
        </nav>

        <div class="page-header">
          <h1>Incident Response Runbook</h1>
          <div class="page-header-meta">
            <span class="page-badge critical">Critical</span>
            <span class="page-reading-time">Operational Runbook</span>
          </div>
          <p class="intro-text">RevFlow Analytics Security Incident Response procedures. Covers detection, triage, containment, eradication, recovery, and lessons learned phases.</p>
        </div>

        <div class="callout critical">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Emergency Contacts</div>
          <div class="callout-content">
            <p><strong>SOC Hotline:</strong> +1-416-555-7621 | <strong>Email:</strong> soc@revflow.com | <strong>Slack:</strong> #soc-alerts</p>
            <p><strong>L3 On-Call:</strong> PagerDuty "RevFlow SOC L3" | <strong>CISO Emergency:</strong> +1-416-555-0100</p>
            <p><strong>War Room:</strong> Teams channel #incident-war-room | <strong>Bridge:</strong> Teams "Security Incident Bridge"</p>
          </div>
        </div>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Document Information</div>
          <div class="callout-content">
            <p><strong>Version:</strong> 4.0 | <strong>Last Updated:</strong> 2024-12-01 | <strong>Owner:</strong> Director, Security Operations</p>
            <p><strong>Review Cycle:</strong> Quarterly | <strong>Last Tabletop:</strong> 2024-10-15</p>
          </div>
        </div>

        <h2>1. Severity Classification</h2>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Severity</th><th>Description</th><th>Response Time</th><th>Owner</th><th>Notification</th></tr></thead>
            <tbody>
              <tr style="background: rgba(239, 68, 68, 0.1);">
                <td><strong>SEV-1 Critical</strong></td>
                <td>Active breach, ransomware, APT, data exfiltration confirmed</td>
                <td>15 minutes</td>
                <td>L3 + Incident Commander</td>
                <td>CISO immediately, CEO within 1 hour, Legal, PR</td>
              </tr>
              <tr style="background: rgba(251, 191, 36, 0.1);">
                <td><strong>SEV-2 High</strong></td>
                <td>Confirmed malware, credential compromise, data exfil attempt</td>
                <td>30 minutes</td>
                <td>L2 SOC Analyst</td>
                <td>CISO within 2 hours, IT Leadership, Department head</td>
              </tr>
              <tr style="background: rgba(59, 130, 246, 0.1);">
                <td><strong>SEV-3 Medium</strong></td>
                <td>Suspicious activity, policy violation, reconnaissance</td>
                <td>2 hours</td>
                <td>L1 → L2 escalation</td>
                <td>Security management (daily summary)</td>
              </tr>
              <tr>
                <td><strong>SEV-4 Low</strong></td>
                <td>Informational, minor policy violation</td>
                <td>4 hours</td>
                <td>L1 SOC Analyst</td>
                <td>None required</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h2>2. Incident Response Phases</h2>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">IR Lifecycle</span></div>
          <pre><code>REVFLOW INCIDENT RESPONSE LIFECYCLE
═══════════════════════════════════════════════════════════════════════════════

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  DETECTION  │───▶│   TRIAGE    │───▶│ CONTAINMENT │───▶│ ERADICATION │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      ▼                  ▼                  ▼                  ▼
  • XDR Alert       • Severity        • Isolate device    • Remove malware
  • Sentinel        • Scope           • Disable account   • Reset credentials
  • User report     • Impact          • Block IP/domain   • Patch vuln
  • Threat intel    • Initial IOCs    • Preserve evidence • Clean systems

                                           │
                    ┌──────────────────────┘
                    ▼
              ┌─────────────┐    ┌─────────────┐
              │  RECOVERY   │───▶│   LESSONS   │
              └─────────────┘    └─────────────┘
                    │                  │
                    ▼                  ▼
               • Restore systems   • PIR (48-72 hrs)
               • Monitor closely   • Update runbooks
               • Validate clean    • Improve detections
               • Return to prod    • Share IOCs</code></pre>
        </div>

        <h2>3. Phase 1: Detection & Initial Response</h2>
        <h3>3.1 Alert Sources</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Source</th><th>Portal</th><th>Alert Volume</th><th>Auto-Ticket</th></tr></thead>
            <tbody>
              <tr><td><strong>M365 Defender XDR</strong></td><td>security.microsoft.com</td><td>~150/day</td><td>Yes (High/Critical)</td></tr>
              <tr><td><strong>Microsoft Sentinel</strong></td><td>portal.azure.com</td><td>~80/day</td><td>Yes (via playbook)</td></tr>
              <tr><td><strong>Defender for Cloud</strong></td><td>portal.azure.com</td><td>~30/day</td><td>Yes (High/Critical)</td></tr>
              <tr><td><strong>User Reports</strong></td><td>phishing@revflow.com</td><td>~20/day</td><td>Manual triage</td></tr>
              <tr><td><strong>External TI</strong></td><td>MS-ISAC, FS-ISAC</td><td>Variable</td><td>Manual assessment</td></tr>
            </tbody>
          </table>
        </div>

        <h3>3.2 L1 Initial Triage Checklist</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Step</th><th>Action</th><th>Tool</th><th>Time</th></tr></thead>
            <tbody>
              <tr><td>1</td><td>Review alert in XDR unified queue</td><td>security.microsoft.com</td><td>2 min</td></tr>
              <tr><td>2</td><td>Check incident correlation (related alerts)</td><td>XDR Incident view</td><td>2 min</td></tr>
              <tr><td>3</td><td>Identify affected assets & users</td><td>Device/User timeline</td><td>3 min</td></tr>
              <tr><td>5</td><td>Review process tree / attack story</td><td>XDR Investigation graph</td><td>5 min</td></tr>
              <tr><td>6</td><td>Check for known IOCs</td><td>VirusTotal, AbuseIPDB</td><td>2 min</td></tr>
              <tr><td>7</td><td>Assign severity & create SEC-INC ticket</td><td>ServiceNow</td><td>2 min</td></tr>
              <tr><td>8</td><td>Escalate if SEV-1/SEV-2 or uncertain</td><td>PagerDuty / Slack</td><td>1 min</td></tr>
            </tbody>
          </table>
        </div>

        <h2>4. Phase 2: Containment</h2>
        <h3>4.1 Containment Actions by Asset Type</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Asset Type</th><th>Containment Action</th><th>Command/Procedure</th><th>Approval</th></tr></thead>
            <tbody>
              <tr>
                <td><strong>Endpoint (Workstation)</strong></td>
                <td>Network isolation via MDE</td>
                <td>XDR → Device → Isolate device</td>
                <td>L2 (L1 for SEV-1)</td>
              </tr>
              <tr>
                <td><strong>Endpoint (Laptop - Remote)</strong></td>
                <td>Network isolation + VPN revoke</td>
                <td>XDR isolate + Disable VPN cert</td>
                <td>L2</td>
              </tr>
              <tr>
                <td><strong>User Account</strong></td>
                <td>Disable account + revoke sessions</td>
                <td>Entra → Users → Revoke sessions, Disable sign-in</td>
                <td>L2</td>
              </tr>
              <tr>
                <td><strong>Service Account</strong></td>
                <td>Disable account (coordinate with owner)</td>
                <td>Entra/AD → Disable + rotate secrets</td>
                <td>L3 + App Owner</td>
              </tr>
              <tr>
                <td><strong>Server (Non-Critical)</strong></td>
                <td>Network isolation or shutdown</td>
                <td>XDR isolate or VM shutdown</td>
                <td>L2 + RF-IT-CLOUD</td>
              </tr>
              <tr>
                <td><strong>Server (Tier 0: DC/CA)</strong></td>
                <td>Network segment isolation</td>
                <td>Firewall rules (DO NOT shutdown DC)</td>
                <td>L3 + CISO + VP Infra</td>
              </tr>
              <tr>
                <td><strong>Cloud Resource</strong></td>
                <td>Isolate via NSG / revoke access</td>
                <td>Azure Portal → NSG deny all</td>
                <td>L2 + RF-IT-CLOUD</td>
              </tr>
              <tr>
                <td><strong>External IP/Domain</strong></td>
                <td>Block at firewall + DNS sinkhole</td>
                <td>Palo Alto + DNS RPZ</td>
                <td>L1 (via playbook)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>4.2 MDE Device Isolation</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">MDE Isolation Procedure</span></div>
          <pre><code>MDE DEVICE ISOLATION - REVFLOW PROCEDURE
═══════════════════════════════════════════════════════════════════════════════

STEP 1: ISOLATE VIA PORTAL
├── Navigate: security.microsoft.com → Endpoints → Device inventory
├── Search: [hostname or device ID]
├── Click: "Isolate device"
├── Select: "Full isolation" (blocks all except MDE cloud)
├── Add comment: "SEC-INC-XXXXX: [brief reason]"
└── Click: "Confirm"

STEP 2: ISOLATE VIA API (Automation)
POST https://api.securitycenter.microsoft.com/api/machines/{id}/isolate
{
    "Comment": "SEC-INC-XXXXX: Malware detected - containment",
    "IsolationType": "Full"
}

STEP 3: VERIFY ISOLATION
├── Device page shows "Isolated" status
├── User sees isolation notification
└── Network test confirms no connectivity

STEP 4: DOCUMENT
├── Update SEC-INC ticket with timestamp
├── Note: Device ID, isolation type, reason
└── Notify device owner (if not the threat actor)

TO RELEASE ISOLATION:
├── Requires L2+ approval
├── Device → "Release from isolation"
├── Monitor for 24 hours post-release
└── Document in ticket</code></pre>
        </div>

        <h3>4.3 Account Containment</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">PowerShell - Account Containment</span><button class="code-copy-btn">Copy</button></div>
          <pre><code># RF-Contain-Account.ps1 - Emergency Account Containment
# Run from PAW with appropriate Entra permissions

param(
    [Parameter(Mandatory=$true)]
    [string]$UserPrincipalName,
    [string]$IncidentNumber
)

Connect-MgGraph -Scopes "User.ReadWrite.All", "Directory.ReadWrite.All"

Write-Host "Containing account: $UserPrincipalName" -ForegroundColor Red
Write-Host "Incident: $IncidentNumber"

# Step 1: Disable sign-in
Update-MgUser -UserId $UserPrincipalName -AccountEnabled:$false
Write-Host "✓ Sign-in disabled"

# Step 2: Revoke all sessions
Revoke-MgUserSignInSession -UserId $UserPrincipalName
Write-Host "✓ All sessions revoked"

# Step 3: Revoke refresh tokens (forces re-auth)
$User = Get-MgUser -UserId $UserPrincipalName
Invoke-MgInvalidateUserRefreshToken -UserId $User.Id
Write-Host "✓ Refresh tokens invalidated"

# Step 4: Reset password (optional - use if credential compromise confirmed)
# $NewPassword = [System.Web.Security.Membership]::GeneratePassword(16,4)
# Update-MgUser -UserId $UserPrincipalName -PasswordProfile @{Password=$NewPassword; ForceChangePasswordNextSignIn=$true}

# Step 5: Remove from privileged groups (if applicable)
$PrivGroups = @("RF-SEC-GlobalAdmins", "RF-SEC-SecurityAdmins", "RF-AD-DomainAdmins")
foreach ($Group in $PrivGroups) {
    try {
        $GroupObj = Get-MgGroup -Filter "displayName eq '$Group'"
        Remove-MgGroupMemberByRef -GroupId $GroupObj.Id -DirectoryObjectId $User.Id -ErrorAction SilentlyContinue
        Write-Host "✓ Removed from $Group"
    } catch {}
}

Write-Host ""
Write-Host "Account contained. Document in SEC-INC-$IncidentNumber" -ForegroundColor Yellow</code></pre>
        </div>

        <h2>5. Phase 3: Investigation</h2>
        <h3>5.1 Investigation Queries (KQL)</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - User Activity Investigation (Sentinel + XDR)</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// RF-INV-UserActivity.kql - Investigate compromised user
// Replace: <UPN> with user principal name, <TIMEFRAME> with lookback
// NOTE: Run identity queries in Sentinel, device queries in XDR Advanced Hunting

let TargetUser = "<UPN>";
let TimeFrame = <TIMEFRAME>; // e.g., 7d

// ═══════════════════════════════════════════════════════════════════════════
// SENTINEL QUERIES (Azure Portal → Sentinel → Logs)
// ═══════════════════════════════════════════════════════════════════════════

// Sign-in activity
SigninLogs
| where TimeGenerated > ago(TimeFrame)
| where UserPrincipalName =~ TargetUser
| project TimeGenerated, UserPrincipalName, AppDisplayName, IPAddress, 
          Location, DeviceDetail, Status, ConditionalAccessStatus
| order by TimeGenerated desc

// Entra audit activity
AuditLogs
| where TimeGenerated > ago(TimeFrame)
| where InitiatedBy.user.userPrincipalName =~ TargetUser
| project TimeGenerated, OperationName, TargetResources, Result

// ═══════════════════════════════════════════════════════════════════════════
// XDR QUERIES (security.microsoft.com → Hunting → Advanced Hunting)
// NOTE: XDR uses "Timestamp" not "TimeGenerated"
// ═══════════════════════════════════════════════════════════════════════════

// Email activity (if mailbox compromise suspected)
EmailEvents
| where Timestamp > ago(TimeFrame)
| where SenderFromAddress =~ TargetUser or RecipientEmailAddress =~ TargetUser
| project Timestamp, Subject, SenderFromAddress, RecipientEmailAddress, 
          DeliveryAction, ThreatTypes

// Endpoint activity (correlate via IdentityInfo)
let UserSID = toscalar(IdentityInfo | where AccountUPN =~ TargetUser | take 1 | project AccountSID);
DeviceLogonEvents
| where Timestamp > ago(TimeFrame)
| where AccountSid == UserSID
| project Timestamp, DeviceName, ActionType, LogonType, RemoteIP</code></pre>
        </div>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Where to Query Device Data</div>
          <div class="callout-content">
            <p><strong>Device telemetry (DeviceProcessEvents, DeviceNetworkEvents, etc.) is NOT ingested to Sentinel.</strong></p>
            <p>Query in <strong>XDR Advanced Hunting</strong> at security.microsoft.com. XDR uses <code>Timestamp</code> not <code>TimeGenerated</code>.</p>
          </div>
        </div>

        <div class="code-block">
          <div class="code-header"><span class="code-lang">KQL - Device Investigation (XDR Advanced Hunting)</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>// RF-INV-DeviceActivity.kql - Investigate compromised device
// WHERE TO RUN: security.microsoft.com → Hunting → Advanced Hunting
// NOTE: XDR uses "Timestamp" not "TimeGenerated"

let TargetDevice = "<DEVICENAME>";
let TimeFrame = 7d;

// Process execution timeline
DeviceProcessEvents
| where Timestamp > ago(TimeFrame)
| where DeviceName =~ TargetDevice
| project Timestamp, FileName, FolderPath, ProcessCommandLine, 
          AccountName, InitiatingProcessFileName
| order by Timestamp desc

// Network connections
DeviceNetworkEvents
| where Timestamp > ago(TimeFrame)
| where DeviceName =~ TargetDevice
| where RemoteIP !startswith "10." and RemoteIP !startswith "192.168."
| project Timestamp, ActionType, RemoteIP, RemotePort, RemoteUrl, 
          InitiatingProcessFileName
| summarize ConnectionCount=count(), FirstSeen=min(Timestamp), 
            LastSeen=max(Timestamp) by RemoteIP, RemotePort
| order by ConnectionCount desc

// File modifications
DeviceFileEvents
| where Timestamp > ago(TimeFrame)
| where DeviceName =~ TargetDevice
| where ActionType in ("FileCreated", "FileModified")
| project Timestamp, ActionType, FileName, FolderPath, 
          InitiatingProcessFileName, SHA256
| order by Timestamp desc

// Alerts on this device
AlertEvidence
| where Timestamp > ago(TimeFrame)
| where DeviceName =~ TargetDevice
| join kind=inner AlertInfo on AlertId
| project Timestamp, AlertId, Title, Severity, Category</code></pre>
        </div>

        <h2>6. Phase 4: Eradication & Recovery</h2>
        <h3>6.1 Eradication Checklist</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Action</th><th>Procedure</th><th>Owner</th><th>Verified</th></tr></thead>
            <tbody>
              <tr><td>Remove malware/tools</td><td>MDE remediation or manual removal</td><td>L2/L3</td><td>☐</td></tr>
              <tr><td>Reset compromised credentials</td><td>All accounts touched by attacker</td><td>RF-SEC-IAM</td><td>☐</td></tr>
              <tr><td>Rotate service account secrets</td><td>Key Vault, app registrations</td><td>RF-SEC-IAM + App Owner</td><td>☐</td></tr>
              <tr><td>Patch exploited vulnerability</td><td>Emergency patch if 0-day</td><td>RF-IT-CLOUD</td><td>☐</td></tr>
              <tr><td>Block attacker IOCs</td><td>Firewall, DNS, MDE custom IOC</td><td>L2</td><td>☐</td></tr>
              <tr><td>Review persistence mechanisms</td><td>Scheduled tasks, services, registry</td><td>L3</td><td>☐</td></tr>
              <tr><td>Scan all potentially affected systems</td><td>MDE full scan, custom IOC hunt</td><td>L2</td><td>☐</td></tr>
            </tbody>
          </table>
        </div>

        <h3>6.2 Recovery Checklist</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Action</th><th>Procedure</th><th>Owner</th><th>Verified</th></tr></thead>
            <tbody>
              <tr><td>Restore from clean backup</td><td>If reimage required</td><td>RF-IT-CLOUD</td><td>☐</td></tr>
              <tr><td>Re-enable user accounts</td><td>After credential reset verified</td><td>RF-SEC-IAM</td><td>☐</td></tr>
              <tr><td>Release device isolation</td><td>MDE portal</td><td>L2</td><td>☐</td></tr>
              <tr><td>Restore network access</td><td>Remove firewall blocks</td><td>RF-IT-NET</td><td>☐</td></tr>
              <tr><td>Monitor for 24-48 hours</td><td>Enhanced logging, alert tuning</td><td>SOC</td><td>☐</td></tr>
              <tr><td>Confirm business operations restored</td><td>User/department confirmation</td><td>Incident Commander</td><td>☐</td></tr>
            </tbody>
          </table>
        </div>

        <h2>7. Phase 5: Post-Incident Review</h2>
        <h3>7.1 PIR Timeline</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Milestone</th><th>Deadline</th><th>Owner</th><th>Deliverable</th></tr></thead>
            <tbody>
              <tr><td>Incident closed</td><td>T+0</td><td>L2/L3</td><td>SEC-INC ticket resolved</td></tr>
              <tr><td>Initial timeline drafted</td><td>T+24h</td><td>L3</td><td>Incident timeline document</td></tr>
              <tr><td>PIR meeting scheduled</td><td>T+48h</td><td>Dir, SecOps</td><td>Meeting invite to stakeholders</td></tr>
              <tr><td>PIR meeting conducted</td><td>T+72h</td><td>All</td><td>Discussion, action items</td></tr>
              <tr><td>PIR report finalized</td><td>T+5 days</td><td>L3</td><td>Final report in Confluence</td></tr>
              <tr><td>Action items tracked</td><td>T+30 days</td><td>Dir, SecOps</td><td>JIRA tickets for improvements</td></tr>
            </tbody>
          </table>
        </div>

        <h3>7.2 PIR Report Template</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">PIR Report Structure</span></div>
          <pre><code>REVFLOW POST-INCIDENT REVIEW REPORT
═══════════════════════════════════════════════════════════════════════════════

INCIDENT SUMMARY
├── Incident ID: SEC-INC-XXXXX
├── Severity: SEV-X
├── Date/Time: YYYY-MM-DD HH:MM UTC
├── Duration: X hours
├── Affected Assets: [list]
├── Affected Users: [count]
└── Business Impact: [description]

TIMELINE
├── T+0:00 - Initial detection
├── T+0:XX - Triage completed, severity assigned
├── T+X:XX - Containment actions taken
├── T+X:XX - Investigation completed
├── T+X:XX - Eradication completed
└── T+X:XX - Recovery and closure

ROOT CAUSE ANALYSIS
├── Attack Vector: [how attacker got in]
├── Vulnerability Exploited: [CVE or misconfiguration]
├── Detection Gap: [why wasn't it caught sooner]
└── Contributing Factors: [other issues]

WHAT WENT WELL
├── [positive item 1]
├── [positive item 2]
└── [positive item 3]

AREAS FOR IMPROVEMENT
├── [improvement 1]
├── [improvement 2]
└── [improvement 3]

ACTION ITEMS
├── [Action] - Owner: [name] - Due: [date] - JIRA: SEC-XXX
├── [Action] - Owner: [name] - Due: [date] - JIRA: SEC-XXX
└── [Action] - Owner: [name] - Due: [date] - JIRA: SEC-XXX

INDICATORS OF COMPROMISE (IOCs)
├── IP Addresses: [list]
├── Domains: [list]
├── File Hashes: [list]
└── Other: [list]</code></pre>
        </div>

        <h2>8. Scenario-Specific Playbooks</h2>
        <h3>8.1 Ransomware Response</h3>
        <div class="callout critical">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Ransomware - IMMEDIATE ACTIONS</div>
          <div class="callout-content">
            <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>DO NOT</strong> pay ransom without CISO + Legal + CEO approval</li>
              <li><strong>DO NOT</strong> shut down infected systems (preserves evidence)</li>
              <li><strong>DO</strong> isolate affected systems immediately via MDE</li>
              <li><strong>DO</strong> disable network shares to prevent spread</li>
              <li><strong>DO</strong> preserve ransom note and encrypted file samples</li>
              <li><strong>DO</strong> engage CISO and consider external IR firm</li>
            </ol>
          </div>
        </div>

        <h3>8.2 Business Email Compromise (BEC)</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Step</th><th>Action</th><th>Owner</th></tr></thead>
            <tbody>
              <tr><td>1</td><td>Contain account (disable, revoke sessions)</td><td>L2</td></tr>
              <tr><td>2</td><td>Check inbox rules for forwarding/deletion</td><td>L2</td></tr>
              <tr><td>3</td><td>Review sent emails for fraud attempts</td><td>L2 + Legal</td></tr>
              <tr><td>4</td><td>Notify recipients of fraudulent emails</td><td>Communications</td></tr>
              <tr><td>5</td><td>Review OAuth app consents</td><td>RF-SEC-IAM</td></tr>
              <tr><td>6</td><td>Reset password + MFA re-enrollment</td><td>RF-SEC-IAM</td></tr>
              <tr><td>7</td><td>If wire fraud attempted, contact bank + FBI IC3</td><td>Legal + Finance</td></tr>
            </tbody>
          </table>
        </div>

        <h3>8.3 Data Exfiltration</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Step</th><th>Action</th><th>Owner</th></tr></thead>
            <tbody>
              <tr><td>1</td><td>Identify scope of data accessed/exfiltrated</td><td>L3</td></tr>
              <tr><td>2</td><td>Determine data classification (PII, financial, IP)</td><td>L3 + GRC</td></tr>
              <tr><td>3</td><td>Engage Legal for breach notification assessment</td><td>Legal</td></tr>
              <tr><td>4</td><td>Preserve evidence for potential litigation</td><td>L3 + Legal</td></tr>
              <tr><td>5</td><td>If PII breach confirmed, follow PIPEDA/GDPR timelines</td><td>Legal + Privacy</td></tr>
              <tr><td>6</td><td>Notify affected customers if required</td><td>Legal + Communications</td></tr>
            </tbody>
          </table>
        </div>

        <h2>9. Communication Templates</h2>
        <h3>9.1 Internal Stakeholder Update</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">Email Template - Stakeholder Update</span></div>
          <pre><code>Subject: [CONFIDENTIAL] Security Incident Update - SEC-INC-XXXXX

Team,

INCIDENT STATUS: [Active Investigation / Contained / Resolved]

SUMMARY:
At [TIME] on [DATE], the Security Operations Center detected [brief description].
Current severity: SEV-[X]

IMPACT:
- Affected systems: [count/description]
- Affected users: [count]
- Business impact: [description]

CURRENT STATUS:
- Containment: [Complete/In Progress]
- Investigation: [Complete/In Progress]
- Eradication: [Complete/In Progress]

NEXT UPDATE: [TIME]

ACTION REQUIRED:
[Any actions needed from recipients]

Questions: Contact SOC at soc@revflow.com or join #incident-war-room

--
[Incident Commander Name]
RevFlow Security Operations</code></pre>
        </div>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Related Resources</div>
          <div class="callout-content">
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/main.js"></script>
</body>
</html>
