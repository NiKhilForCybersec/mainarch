<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log Source Strategy | SIEM Migration</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <div class="layout">
        <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">RF</div>
          <div class="sidebar-logo-text">
            <span class="sidebar-logo-title">Security Transformation</span>
            <span class="sidebar-logo-subtitle">RevFlow Analytics</span>
          </div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <a href="../index.html" class="nav-item">Executive Summary</a>
          <a href="../company-profile.html" class="nav-item">Company Profile</a>
          <a href="../security-framework.html" class="nav-item">Security Framework</a>
          <a href="../program-structure.html" class="nav-item">Program Structure</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">SIEM Migration</div>
          <a href="../siem/index.html" class="nav-item">SIEM Overview</a>
          <a href="../siem/discovery.html" class="nav-item">Discovery & Assessment</a>
          <a href="../siem/log-sources.html" class="nav-item active">Log Source Strategy</a>
          <a href="../siem/log-engineering.html" class="nav-item">Log Engineering</a>
          <a href="../siem/detection-engineering.html" class="nav-item">Detection Engineering</a>
          <a href="../siem/detection-catalog.html" class="nav-item">Detection Catalog</a>
          <a href="../siem/soc-transition.html" class="nav-item">SOC Transition</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">EDR Migration</div>
          <a href="../edr/index.html" class="nav-item">EDR Overview</a>
          <a href="../edr/deployment.html" class="nav-item">MDE Deployment</a>
          <a href="../edr/asr-rules.html" class="nav-item">ASR Rules</a>
          <a href="../edr/coexistence.html" class="nav-item">Coexistence Strategy</a>
          <a href="../edr/eset-removal.html" class="nav-item">ESET Removal</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">DLP Migration</div>
          <a href="../dlp/index.html" class="nav-item">DLP Overview</a>
          <a href="../dlp/dlp-catalog.html" class="nav-item">DLP Catalog</a>
          <a href="../dlp/policy-translation.html" class="nav-item">Policy Translation</a>
          <a href="../dlp/rollout-phases.html" class="nav-item">Rollout Phases</a>
          <a href="../dlp/user-communication.html" class="nav-item">User Communication</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Identity & Access</div>
          <a href="../identity/index.html" class="nav-item">Identity Overview</a>
          <a href="../identity/hybrid-setup.html" class="nav-item">Hybrid Identity</a>
          <a href="../identity/conditional-access.html" class="nav-item">Conditional Access</a>
          <a href="../identity/pim.html" class="nav-item">PIM Configuration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Infrastructure</div>
          <a href="../infrastructure/index.html" class="nav-item">Infrastructure Overview</a>
          <a href="../infrastructure/landing-zone.html" class="nav-item">Landing Zone</a>
          <a href="../infrastructure/network-architecture.html" class="nav-item">Network Architecture</a>
          <a href="../infrastructure/workload-migration.html" class="nav-item">Workload Migration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="../operations/parallel-ops.html" class="nav-item">Parallel Operations</a>
          <a href="../operations/soc-workflows.html" class="nav-item">SOC Workflows</a>
          <a href="../operations/integration.html" class="nav-item">Platform Integration</a>
          <a href="../operations/xdr-integration.html" class="nav-item">XDR Integration</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Resources</div>
          <a href="../resources/timeline.html" class="nav-item">Project Timeline</a>
          <a href="../resources/raci.html" class="nav-item">RACI Matrix</a>
          <a href="../resources/infrastructure-reference.html" class="nav-item">Infrastructure Reference</a>
          <a href="../resources/scripts.html" class="nav-item">Scripts & Queries</a>
          <a href="../resources/data-dictionary.html" class="nav-item">Data Dictionary</a>
          <a href="../resources/templates.html" class="nav-item">Templates</a>
          <a href="../resources/splunk-reference.html" class="nav-item">Splunk Reference</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Runbooks</div>
          <a href="../resources/mde-onboarding.html" class="nav-item">MDE Onboarding</a>
          <a href="../resources/mde-offboarding.html" class="nav-item">MDE Offboarding</a>
          <a href="../resources/incident-response.html" class="nav-item">Incident Response</a>
          <a href="../resources/operational-procedures.html" class="nav-item">Operational Procedures</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Troubleshooting</div>
          <a href="../troubleshooting/index.html" class="nav-item">Common Issues</a>
          <a href="../troubleshooting/siem-issues.html" class="nav-item">SIEM Issues</a>
          <a href="../troubleshooting/mde-issues.html" class="nav-item">MDE Issues</a>
          <a href="../troubleshooting/dlp-issues.html" class="nav-item">DLP Issues</a>
          <a href="../troubleshooting/agent-conflicts.html" class="nav-item">Agent Conflicts</a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
          <div class="nav-section-title">Career</div>
          <a href="../career-narrative.html" class="nav-item">Career Narrative</a>
          <a href="../interview-prep.html" class="nav-item">Interview Prep</a>
        </div>
      </nav>
    </aside>
    <button class="mobile-menu-toggle" aria-label="Toggle menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"></path></svg>
    </button>
    <div class="sidebar-overlay"></div>
    <main class="main-content">
      <div class="content-wrapper">
        <nav class="breadcrumb">
          <a href="../index.html">Home</a>
          <span class="breadcrumb-separator">/</span>
          <a href="index.html">SIEM Migration</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">Log Source Strategy</span>
        </nav>

        <div class="page-header">
          <h1>Log Source Strategy</h1>
          <div class="page-header-meta">
            <span class="page-badge siem">SIEM Track</span>
            <span class="page-reading-time">Core Planning Document</span>
          </div>
          <p class="intro-text">Not all logs belong in Sentinel. This document defines what goes where, why, and how. The key principle: <strong>Sentinel for security, Splunk for operations</strong>.</p>
        </div>

        <div class="callout info">
          <div class="callout-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
            Compliance-Aware Log Architecture
          </div>
          <div class="callout-content">
            <p><strong>Single Workspace:</strong> All logs flow to a centralized Sentinel workspace in Canada, supporting our centralized SOC.</p>
            <p><strong>EU Data Handling:</strong> Identity logs contain personal data (EU users) → protected via Standard Contractual Clauses (SCCs), RBAC access controls, and defined retention limits.</p>
            <p><strong>Data Minimization:</strong> No unnecessary PII ingestion. Endpoint and network logs are primarily metadata, not content.</p>
          </div>
        </div>

        <h2>The Two-Platform Architecture</h2>
        <p>RevFlow already operates Splunk Cloud for application monitoring and business analytics. Rather than migrate everything to Sentinel, we maintain clear separation of concerns:</p>

        <div class="comparison-grid">
          <div class="comparison-column">
            <div class="comparison-header" style="background-color: rgba(56, 139, 253, 0.15); color: var(--accent-blue);">Microsoft Sentinel (Security)</div>
            <div class="comparison-content">
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Threat detection & hunting</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Incident response workflows</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Compliance monitoring</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Identity threat analytics</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Cloud security posture</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>SOC operations</span></div>
            </div>
          </div>
          <div class="comparison-column">
            <div class="comparison-header" style="background-color: rgba(57, 211, 83, 0.15); color: var(--accent-cyan);">Splunk Cloud (Operations)</div>
            <div class="comparison-content">
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Application performance</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Business transaction logs</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>SRE dashboards</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>API metrics & debugging</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Infrastructure metrics</span></div>
              <div class="comparison-item"><span class="comparison-item-icon">✓</span><span>Engineering troubleshooting</span></div>
            </div>
          </div>
        </div>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Why Not Consolidate?</div>
          <div class="callout-content">
            <p><strong>Cost:</strong> Sentinel charges ~$2.76/GB. Sending all app logs would be prohibitively expensive.</p>
            <p><strong>Ownership:</strong> Engineering owns their Splunk dashboards. Migrating them adds months of work.</p>
            <p><strong>Focus:</strong> Clear boundaries mean clear accountability. Security owns Sentinel, Engineering owns Splunk.</p>
          </div>
        </div>

        <h2>Complete Log Source Mapping</h2>

        <h3>Identity & Access Logs → Sentinel (Highest Priority)</h3>
        <p><strong>Detection anchor #1.</strong> Identity is the foundation of security correlation. Contains personal data (usernames, IPs, locations) — protected via SCCs, RBAC, and retention limits.</p>

        <div class="callout warning">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Critical: MDI + XDR ≠ Entra ID Logs</div>
          <div class="callout-content">
            <p><strong>Defender for Identity (MDI) + XDR</strong> covers identity <em>attacks</em> — credential theft, lateral movement, privilege escalation. This is behavioral, attack-focused telemetry that produces XDR incidents.</p>
            <p><strong>Entra ID diagnostic logs</strong> cover identity <em>operations</em> — who signed in, role changes, app consents, MFA policy changes. These are control-plane logs for governance, compliance, and audit.</p>
            <p style="margin-top: 0.5rem;"><strong>They are complementary, not duplicates.</strong> You need both. XDR does NOT replace Entra ID diagnostic logs.</p>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Sentinel Table</th><th>Connector</th><th>Volume/Day</th><th>Cost</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Entra ID Sign-in Logs</strong></td><td><code>SigninLogs</code></td><td>Microsoft Entra ID</td><td>10-30 GB</td><td>Free*</td></tr>
              <tr><td><strong>Entra ID Audit Logs</strong></td><td><code>AuditLogs</code></td><td>Microsoft Entra ID</td><td>1-5 GB</td><td>Free*</td></tr>
              <tr><td><strong>Non-Interactive Sign-ins</strong></td><td><code>AADNonInteractiveUserSignInLogs</code></td><td>Microsoft Entra ID</td><td>5-20 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Service Principal Sign-ins</strong></td><td><code>AADServicePrincipalSignInLogs</code></td><td>Microsoft Entra ID</td><td>1-5 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Identity Protection Events</strong></td><td><code>AADUserRiskEvents</code></td><td>Microsoft Entra ID</td><td>&lt;500 MB</td><td>Free</td></tr>
              <tr><td><strong>Conditional Access Events</strong></td><td><code>SigninLogs</code></td><td>Microsoft Entra ID</td><td>Included above</td><td>Free*</td></tr>
              <tr><td><strong>Risky Sign-ins / Users</strong></td><td><code>AADRiskyUsers</code></td><td>Microsoft Entra ID</td><td>&lt;100 MB</td><td>Free</td></tr>
            </tbody>
          </table>
        </div>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Why You Still Need Entra ID Logs (Even with XDR)</div>
          <div class="callout-content">
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>Governance & compliance:</strong> Who granted admin rights? Who modified Conditional Access? Who consented to an app?</li>
              <li><strong>Identity change tracking:</strong> Role assignments, MFA policy changes, app registrations — not attacks, but security-relevant</li>
              <li><strong>Cross-domain correlation:</strong> XDR identity incident + recent admin role assignment requires Entra ID logs</li>
              <li><strong>Investigation context:</strong> Validate XDR incident with sign-in location, device, CA policy applied</li>
            </ul>
          </div>
        </div>

        <h4>How to Enable: Entra ID Diagnostic Settings</h4>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">Azure Portal Steps</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>1. Azure Portal → Microsoft Entra ID → Diagnostic settings
2. Click "+ Add diagnostic setting"
3. Name: "SendToSentinel"
4. Select log categories:
   ☑ SignInLogs
   ☑ AuditLogs
   ☑ NonInteractiveUserSignInLogs
   ☑ ServicePrincipalSignInLogs
   ☑ ManagedIdentitySignInLogs
   ☑ RiskyUsers
   ☑ UserRiskEvents
5. Destination: "Send to Log Analytics workspace"
6. Select your Sentinel workspace
7. Save

Verify: SigninLogs | take 10</code></pre>
        </div>

        <h3>Endpoint & XDR Data → Sentinel (Detection Anchor #2)</h3>
        <p><strong>XDR-First Ingestion Strategy:</strong> With M365 Defender XDR enabled, we consume <strong>XDR incidents and alerts</strong>, not raw Device* tables. XDR already correlates endpoint telemetry and produces high-fidelity incidents. Raw table ingestion is optional and selective.</p>

        <div class="callout warning">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Critical: Don't Ingest All Raw Tables</div>
          <div class="callout-content">
            <p><strong>Anti-Pattern:</strong> Ingesting all Device* tables (DeviceProcessEvents, DeviceNetworkEvents, etc.) into Sentinel when XDR is enabled.</p>
            <p><strong>Why it's wrong:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Duplicates detection — XDR already correlates these events</li>
              <li>Increases storage cost — even "free" ingestion has retention costs</li>
              <li>Creates noise — SOC sees same events in multiple places</li>
              <li>Confuses workflows — which source of truth?</li>
            </ul>
            <p style="margin-top: 0.5rem;"><strong>Best Practice:</strong> Consume XDR incidents. Selectively ingest raw tables only for specific cross-domain correlation needs.</p>
          </div>
        </div>

        <h4>What We Ingest (XDR-First)</h4>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Data Type</th><th>Sentinel Table</th><th>Ingestion</th><th>Volume</th><th>Why</th></tr>
            </thead>
            <tbody>
              <tr style="background: rgba(34, 197, 94, 0.1);">
                <td><strong>XDR Incidents</strong></td>
                <td><code>SecurityIncident</code></td>
                <td><span class="status-badge complete">Always</span></td>
                <td>&lt;100 MB/day</td>
                <td>Correlated incidents from XDR — primary detection source</td>
              </tr>
              <tr style="background: rgba(34, 197, 94, 0.1);">
                <td><strong>XDR Alerts</strong></td>
                <td><code>SecurityAlert</code></td>
                <td><span class="status-badge complete">Always</span></td>
                <td>&lt;500 MB/day</td>
                <td>Individual alerts before XDR correlation</td>
              </tr>
              <tr style="background: rgba(59, 130, 246, 0.1);">
                <td><strong>Device Network Events</strong></td>
                <td><code>DeviceNetworkEvents</code></td>
                <td><span class="status-badge in-progress">Selective</span></td>
                <td>~20 GB/day (filtered)</td>
                <td>For XDR + firewall correlation (higher-order rules)</td>
              </tr>
              <tr>
                <td><strong>Device Process Events</strong></td>
                <td><code>DeviceProcessEvents</code></td>
                <td><span class="status-badge">Not Ingested</span></td>
                <td>—</td>
                <td>XDR handles process-based detection</td>
              </tr>
              <tr>
                <td><strong>Device File Events</strong></td>
                <td><code>DeviceFileEvents</code></td>
                <td><span class="status-badge">Not Ingested</span></td>
                <td>—</td>
                <td>XDR handles file-based detection</td>
              </tr>
              <tr>
                <td><strong>Device Registry Events</strong></td>
                <td><code>DeviceRegistryEvents</code></td>
                <td><span class="status-badge">Not Ingested</span></td>
                <td>—</td>
                <td>XDR handles registry-based detection</td>
              </tr>
              <tr>
                <td><strong>Device Logon Events</strong></td>
                <td><code>DeviceLogonEvents</code></td>
                <td><span class="status-badge">Not Ingested</span></td>
                <td>—</td>
                <td>XDR + MDI handles logon correlation</td>
              </tr>
              <tr>
                <td><strong>Email Events</strong></td>
                <td><code>EmailEvents</code></td>
                <td><span class="status-badge">Not Ingested</span></td>
                <td>—</td>
                <td>XDR (MDO) handles email detection</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="callout info">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>When to Selectively Ingest Raw Tables</div>
          <div class="callout-content">
            <p><strong>You ingest selectively only when at least one of these is true:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>Cross-domain correlation XDR can't do:</strong> XDR incident + firewall/DNS logs, endpoint behavior + cloud/IAM actions outside Defender</li>
              <li><strong>Bespoke detections not covered by XDR:</strong> Very specific internal tooling misuse, regulated workflows requiring explicit logic</li>
              <li><strong>Migration/validation phase:</strong> Short-term overlap to compare XDR vs legacy rules — retire after confidence is established</li>
            </ul>
          </div>
        </div>

        <div class="callout warning">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Decision Checklist: Should I Ingest This MDE Table?</div>
          <div class="callout-content">
            <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Does XDR already detect and explain this behavior? <strong>(If yes → don't ingest)</strong></li>
              <li>Do I need raw fields for correlation with non-Defender data? <strong>(If yes → ingest selectively)</strong></li>
              <li>Is the cost and complexity justified?</li>
              <li>Is this temporary (migration) or permanent? <strong>(Review quarterly)</strong></li>
            </ol>
            <p style="margin-top: 0.5rem;"><strong>If #1 is "yes" and #2 is "no" → don't ingest raw MDE tables.</strong></p>
          </div>
        </div>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>What Mature Environments Actually Do</div>
          <div class="callout-content">
            <p><strong>Default posture:</strong> Ingest SecurityIncident + SecurityAlert from XDR. Do NOT ingest full Device* telemetry.</p>
            <p><strong>Selective posture:</strong> Ingest 1-2 Device* tables with filters (event types, devices, time). Review quarterly and remove if unused.</p>
          </div>
        </div>

        <h4>How to Enable: XDR Incident Sync (Required)</h4>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">Steps</span><button class="code-copy-btn">Copy</button></div>
          <pre><code>1. Sentinel → Content Hub → "Microsoft 365 Defender" → Install
2. Data Connectors → Microsoft 365 Defender → Open connector page
3. Configuration:
   ☑ Connect incidents & alerts (REQUIRED)
   ☑ Connect entities
4. Under "Connect events" (Advanced Hunting):
   ⚠️ DO NOT enable all tables by default
   
   Only enable if you have a specific use case:
   ☐ DeviceProcessEvents — Only if needed for custom hunting
   ☑ DeviceNetworkEvents — If doing XDR + firewall correlation
   ☐ DeviceFileEvents — Only if needed for custom hunting
   ☐ DeviceLogonEvents — XDR + MDI handles this
   ☐ EmailEvents — XDR (MDO) handles this

5. Click "Apply Changes"

Verify: SecurityIncident | where ProviderName == "Microsoft 365 Defender" | take 10</code></pre>
        </div>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Cost Optimization</div>
          <div class="callout-content">
            <p><strong>Before (naive approach):</strong> Ingest all Device* tables — ~150 GB/day. Even with "free" ingestion, storage and compute costs add up.</p>
            <p><strong>After (XDR-first):</strong> Ingest XDR incidents + 1 selective table — ~25 GB/day. 80%+ reduction in endpoint data volume.</p>
          </div>
        </div>

        <h3>Cloud Control Plane → Sentinel (Detection Anchor #3)</h3>
        <p><strong>High security value, low personal data.</strong> Azure RBAC changes, resource creation, privilege escalation. Infrastructure actions, not user PII.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Sentinel Table</th><th>Connector</th><th>Volume/Day</th><th>Cost</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Azure Activity Log</strong></td><td><code>AzureActivity</code></td><td>Azure Activity</td><td>1-5 GB</td><td>Free</td></tr>
              <tr><td><strong>Defender for Cloud Alerts</strong></td><td><code>SecurityAlert</code></td><td>Defender for Cloud</td><td>&lt;1 GB</td><td>Free</td></tr>
              <tr><td><strong>Azure Key Vault</strong></td><td><code>AzureDiagnostics</code></td><td>Diagnostic Settings</td><td>0.5-2 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Azure Firewall</strong></td><td><code>AzureDiagnostics</code></td><td>Diagnostic Settings</td><td>10-50 GB</td><td>Basic</td></tr>
              <tr><td><strong>NSG Flow Logs</strong></td><td><code>AzureNetworkAnalytics_CL</code></td><td>NSG Flow Logs</td><td>50-200 GB</td><td>Basic</td></tr>
              <tr><td><strong>Azure RBAC Changes</strong></td><td><code>AzureActivity</code></td><td>Azure Activity</td><td>Included above</td><td>Free</td></tr>
            </tbody>
          </table>
        </div>

        <h3>AWS Logs → Sentinel (Legacy Workloads)</h3>
        <p>AWS workloads are legacy — migrating to Azure over time. Still need visibility for security coverage.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Sentinel Table</th><th>Connector</th><th>Volume/Day</th><th>Cost</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>AWS CloudTrail</strong></td><td><code>AWSCloudTrail</code></td><td>AWS S3 Connector</td><td>5-20 GB</td><td>Analytics</td></tr>
              <tr><td><strong>AWS VPC Flow Logs</strong></td><td><code>AWSVPCFlow</code></td><td>AWS S3 Connector</td><td>20-100 GB</td><td>Basic</td></tr>
              <tr><td><strong>AWS GuardDuty</strong></td><td><code>AWSGuardDuty</code></td><td>AWS S3 Connector</td><td>&lt;1 GB</td><td>Analytics</td></tr>
            </tbody>
          </table>
        </div>

        <h4>How to Enable: AWS CloudTrail</h4>
        <div class="flow-diagram">
          <div class="flow-step"><div class="flow-step-number">1</div><div class="flow-step-content"><strong>AWS: Enable CloudTrail → S3</strong><br>Configure CloudTrail to log to S3 bucket with SQS notifications</div></div>
          <div class="flow-connector">↓</div>
          <div class="flow-step"><div class="flow-step-number">2</div><div class="flow-step-content"><strong>AWS: Create IAM Role</strong><br>Create role with S3 read and SQS permissions for Sentinel</div></div>
          <div class="flow-connector">↓</div>
          <div class="flow-step"><div class="flow-step-number">3</div><div class="flow-step-content"><strong>Sentinel: Install AWS Connector</strong><br>Content Hub → Amazon Web Services → Configure with Role ARN</div></div>
        </div>

        <h3>Network & On-Premises → Sentinel</h3>
        <p><strong>Metadata-only, no packet capture.</strong> DNS logs, firewall logs, auth events. On-prem systems migrating to Azure over time.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Sentinel Table</th><th>Collection Method</th><th>Volume/Day</th><th>Cost</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Windows Security Events</strong></td><td><code>SecurityEvent</code></td><td>Azure Monitor Agent + DCR</td><td>10-50 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Windows Sysmon</strong></td><td><code>Event</code></td><td>Azure Monitor Agent + DCR</td><td>5-20 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Linux Auth Logs</strong></td><td><code>Syslog</code></td><td>Azure Monitor Agent + DCR</td><td>1-5 GB</td><td>Analytics</td></tr>
              <tr><td><strong>DNS Server Logs</strong></td><td><code>DnsEvents</code></td><td>DNS Analytics</td><td>10-50 GB</td><td>Basic</td></tr>
              <tr><td><strong>Firewall (CEF)</strong></td><td><code>CommonSecurityLog</code></td><td>CEF via AMA</td><td>20-100 GB</td><td>Basic</td></tr>
            </tbody>
          </table>
        </div>

        <h3>Email & SaaS Applications → Sentinel</h3>
        <p><strong>Business data — protected via data minimization and access control.</strong> Salesforce audit logs, M365 audit, other SaaS business apps.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Sentinel Table</th><th>Connector</th><th>Volume/Day</th><th>Cost</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Salesforce Event Monitoring</strong></td><td><code>SalesforceServiceCloud_CL</code></td><td>Salesforce Connector</td><td>1-10 GB</td><td>Analytics</td></tr>
              <tr><td><strong>GitHub Audit Logs</strong></td><td><code>GitHubAuditLogPolling_CL</code></td><td>GitHub Connector</td><td>0.5-2 GB</td><td>Analytics</td></tr>
              <tr><td><strong>Zoom Audit Logs</strong></td><td><code>Zoom_CL</code></td><td>Custom Function App</td><td>&lt;500 MB</td><td>Analytics</td></tr>
            </tbody>
          </table>
        </div>

        <div class="callout warning">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Salesforce Shield Required</div>
          <div class="callout-content"><p>Full Salesforce Event Monitoring requires Shield license (~$10/user/month). Without it, only basic login history is available. Verify licensing before planning detections.</p></div>
        </div>

        <hr>

        <h2>What Stays in Splunk (Operations)</h2>
        <p>These logs remain in Splunk Cloud. Engineering owns these workflows.</p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Source</th><th>Splunk Index</th><th>Owner</th><th>Purpose</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Application Performance</strong></td><td><code>app_perf</code></td><td>SRE</td><td>Response times, errors, throughput</td></tr>
              <tr><td><strong>RevFlow API Logs</strong></td><td><code>api_logs</code></td><td>Engineering</td><td>API debugging, call patterns</td></tr>
              <tr><td><strong>Salesforce Integration</strong></td><td><code>sf_integration</code></td><td>Engineering</td><td>Data sync, quota usage</td></tr>
              <tr><td><strong>Data Pipeline</strong></td><td><code>data_pipeline</code></td><td>Data Eng</td><td>ETL jobs, data quality</td></tr>
              <tr><td><strong>Kubernetes Logs</strong></td><td><code>k8s_logs</code></td><td>SRE</td><td>Container logs, scaling</td></tr>
              <tr><td><strong>Business Transactions</strong></td><td><code>business_txn</code></td><td>Product</td><td>Feature usage, funnels</td></tr>
            </tbody>
          </table>
        </div>

        <hr>

        <h2>Cost Optimization: Analytics vs Basic Logs</h2>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Feature</th><th>Analytics Logs</th><th>Basic Logs</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>Price</strong></td><td>~$2.76/GB</td><td>~$0.50/GB</td></tr>
              <tr><td><strong>Interactive Retention</strong></td><td>90 days</td><td>8 days</td></tr>
              <tr><td><strong>Analytics Rules</strong></td><td>✓ Supported</td><td>✗ Not supported</td></tr>
              <tr><td><strong>Use Case</strong></td><td>Active detection & hunting</td><td>Compliance, forensics</td></tr>
            </tbody>
          </table>
        </div>

        <h3>Recommended Tier Assignments</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Log Type</th><th>Tier</th><th>Rationale</th></tr>
            </thead>
            <tbody>
              <tr><td>Entra ID Sign-ins</td><td><span class="status-badge complete">Analytics</span></td><td>Critical for identity detection</td></tr>
              <tr><td>MDE Telemetry</td><td><span class="status-badge complete">Free (XDR)</span></td><td>Free via M365 Defender</td></tr>
              <tr><td>AWS CloudTrail</td><td><span class="status-badge complete">Analytics</span></td><td>Cloud security detection</td></tr>
              <tr><td>NSG Flow Logs</td><td><span class="status-badge in-progress">Basic</span></td><td>High volume, forensics only</td></tr>
              <tr><td>Firewall Logs</td><td><span class="status-badge in-progress">Basic</span></td><td>High volume, selective queries</td></tr>
            </tbody>
          </table>
        </div>

        <h2>Monthly Cost Projection (9,000 Endpoints)</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Category</th><th>Monthly Volume</th><th>Tier</th><th>Monthly Cost</th></tr>
            </thead>
            <tbody>
              <tr><td>Identity (Entra ID)</td><td>900 GB</td><td>Analytics</td><td>$2,484</td></tr>
              <tr><td>MDE Telemetry (9,000 endpoints)</td><td>5,400 GB</td><td>Free (XDR)</td><td>$0</td></tr>
              <tr><td>Azure Activity</td><td>150 GB</td><td>Free</td><td>$0</td></tr>
              <tr><td>AWS CloudTrail</td><td>450 GB</td><td>Analytics</td><td>$1,242</td></tr>
              <tr><td>Windows Security</td><td>900 GB</td><td>Analytics</td><td>$2,484</td></tr>
              <tr><td>Network Logs (Firewall, NSG)</td><td>3,600 GB</td><td>Basic</td><td>$1,800</td></tr>
              <tr><td>SaaS Apps (Salesforce, etc.)</td><td>450 GB</td><td>Analytics</td><td>$1,242</td></tr>
              <tr><td>Linux/Server Logs</td><td>600 GB</td><td>Analytics</td><td>$1,656</td></tr>
              <tr style="background-color: var(--bg-tertiary); font-weight: 600;"><td><strong>Total</strong></td><td><strong>~12,500 GB</strong></td><td></td><td><strong>~$11,000/mo</strong></td></tr>
              <tr style="background-color: rgba(63, 185, 80, 0.1);"><td><em>Free XDR Data</em></td><td><em>5,400 GB</em></td><td>—</td><td><em>Would be ~$14,900</em></td></tr>
            </tbody>
          </table>
        </div>

        <div class="callout success">
          <div class="callout-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Cost Savings</div>
          <div class="callout-content">
            <p><strong>RSA NetWitness:</strong> ~$35,000/month for comparable coverage.</p>
            <p><strong>Sentinel:</strong> ~$11,000/month with commitment tier pricing.</p>
            <p><strong>Free XDR Telemetry:</strong> 5,400 GB/month of endpoint data ingested at no cost via M365 Defender connector.</p>
            <p><strong>Result:</strong> 69% cost reduction with improved cloud-native capabilities and unified XDR experience.</p>
          </div>
        </div>

        <h2>Industry Best Practices</h2>
        
        <div class="callout info">
          <div class="callout-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
            Log Ingestion Best Practices
          </div>
          <div class="callout-content">
            <p><strong>Microsoft & Industry Recommendations:</strong></p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>Retention:</strong> 90 days hot for investigation, 1+ year archive for compliance (NIST, SOC 2)</li>
              <li><strong>Prioritization:</strong> Identity → Endpoint → Cloud → Network (CIS Controls, MITRE D3FEND)</li>
              <li><strong>Cost Optimization:</strong> Use commitment tiers at 100+ GB/day for 50% savings</li>
              <li><strong>Basic vs Analytics:</strong> Use Basic tier for high-volume, low-query logs (firewall, flow)</li>
              <li><strong>XDR Integration:</strong> Always enable M365 Defender connector first — free high-value telemetry</li>
              <li><strong>Data Minimization:</strong> Filter at source, not after ingestion (GDPR, privacy compliance)</li>
            </ul>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Best Practice</th><th>Standard/Source</th><th>Our Implementation</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>Log all authentication events</td>
                <td>NIST 800-53 AU-2, CIS Control 8</td>
                <td>Entra ID sign-in + audit logs, full coverage</td>
              </tr>
              <tr>
                <td>Retain security logs 1 year minimum</td>
                <td>SOC 2, PCI-DSS, ISO 27001</td>
                <td>90 days hot, 1 year archive tier</td>
              </tr>
              <tr>
                <td>Centralize security telemetry</td>
                <td>MITRE D3FEND, Gartner SOC recommendations</td>
                <td>Single Sentinel workspace, unified XDR</td>
              </tr>
              <tr>
                <td>Monitor privileged access</td>
                <td>CIS Control 5, NIST 800-53 AC-6</td>
                <td>PIM logs, admin audit, role changes</td>
              </tr>
              <tr>
                <td>Log endpoint process execution</td>
                <td>MITRE ATT&CK, CIS Control 8</td>
                <td>MDE DeviceProcessEvents with command line</td>
              </tr>
            </tbody>
          </table>
        </div>

        <nav class="page-nav">
          <a href="discovery.html" class="page-nav-link prev"><span class="page-nav-label">Previous</span><span class="page-nav-title">← Discovery & Assessment</span></a>
          <a href="log-engineering.html" class="page-nav-link next"><span class="page-nav-label">Next</span><span class="page-nav-title">Log Engineering →</span></a>
        </nav>
      </div>
    </main>
  </div>
  <script src="../js/main.js"></script>
</body>
</html>
